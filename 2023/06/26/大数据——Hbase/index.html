<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>大数据——Hbase | ccbigs blog</title><meta name="author" content="DingQuan Zuo"><meta name="copyright" content="DingQuan Zuo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="HBase第1章HBase简介1.1HBase定义HBase是一种分布式、可扩展、支持海量数据存储的NoSQL数据库。 1.2HBase数据模型逻辑上，HBase的数据模型同关系型数据库很类似，数据存储在一张表中，有行有列。但从HBase的底层物理存储结构（K-V）来看，HBase更像是一个multi-dimensionalmap。 1.2.1HBase逻辑结构字典序：按位比较。 下图是一张表，但">
<meta property="og:type" content="article">
<meta property="og:title" content="大数据——Hbase">
<meta property="og:url" content="http://example.com/2023/06/26/%E5%A4%A7%E6%95%B0%E6%8D%AE%E2%80%94%E2%80%94Hbase/index.html">
<meta property="og:site_name" content="ccbigs blog">
<meta property="og:description" content="HBase第1章HBase简介1.1HBase定义HBase是一种分布式、可扩展、支持海量数据存储的NoSQL数据库。 1.2HBase数据模型逻辑上，HBase的数据模型同关系型数据库很类似，数据存储在一张表中，有行有列。但从HBase的底层物理存储结构（K-V）来看，HBase更像是一个multi-dimensionalmap。 1.2.1HBase逻辑结构字典序：按位比较。 下图是一张表，但">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/ahead.jpg">
<meta property="article:published_time" content="2023-06-26T08:53:45.000Z">
<meta property="article:modified_time" content="2023-06-26T09:25:23.362Z">
<meta property="article:author" content="DingQuan Zuo">
<meta property="article:tag" content="大数据">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/ahead.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/06/26/%E5%A4%A7%E6%95%B0%E6%8D%AE%E2%80%94%E2%80%94Hbase/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '大数据——Hbase',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-26 17:25:23'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/ahead.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/1558.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ccbigs blog"><img class="site-icon" src="/img/favicon.png"/><span class="site-name">ccbigs blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">大数据——Hbase</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-26T08:53:45.000Z" title="发表于 2023-06-26 16:53:45">2023-06-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-26T09:25:23.362Z" title="更新于 2023-06-26 17:25:23">2023-06-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="大数据——Hbase"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="HBase"><a href="#HBase" class="headerlink" title="HBase"></a>HBase</h1><h1 id="第1章HBase简介"><a href="#第1章HBase简介" class="headerlink" title="第1章HBase简介"></a>第1章HBase简介</h1><h2 id="1-1HBase定义"><a href="#1-1HBase定义" class="headerlink" title="1.1HBase定义"></a>1.1HBase定义</h2><p>HBase是一种分布式、可扩展、支持海量数据存储的NoSQL数据库。</p>
<h2 id="1-2HBase数据模型"><a href="#1-2HBase数据模型" class="headerlink" title="1.2HBase数据模型"></a>1.2HBase数据模型</h2><p>逻辑上，HBase的数据模型同关系型数据库很类似，数据存储在一张表中，有行有列。但从HBase的底层物理存储结构（K-V）来看，HBase更像是一个<strong>multi-dimensionalmap</strong>。</p>
<h3 id="1-2-1HBase逻辑结构"><a href="#1-2-1HBase逻辑结构" class="headerlink" title="1.2.1HBase逻辑结构"></a>1.2.1HBase逻辑结构</h3><p>字典序：按位比较。</p>
<p>下图是一张表，但是一张表往往会被切分开来，分配在不同区域。</p>
<p><img src="/.com//image-20211216184429095.png" alt="image-20211216184429095"></p>
<h3 id="1-2-2HBase物理存储结构"><a href="#1-2-2HBase物理存储结构" class="headerlink" title="1.2.2HBase物理存储结构"></a>1.2.2HBase物理存储结构</h3><p><strong>该数据结构是对上图的store的一个详解</strong></p>
<p><img src="/.com//image-20211216184539052.png" alt="image-20211216184539052"></p>
<h3 id="1-2-3数据模型"><a href="#1-2-3数据模型" class="headerlink" title="1.2.3数据模型"></a>1.2.3数据模型</h3><blockquote>
<p> 1）NameSpace</p>
</blockquote>
<p>命名空间，类似于关系型数据库的DatabBase(数据库)概念，每个命名空间下有多个表。HBase有两个自带的命名空间，分别是<strong>hbase和default</strong>，hbase中存放的是HBase内置的表，default表是用户默认使用的命名空间。</p>
<blockquote>
<p>2）Region</p>
</blockquote>
<p>类似于关系型数据库的表概念。不同的是，HBase定义表时只需要声明列族即可，不需要声明具体的列。这意味着，往HBase写入数据时，字段可以<strong>动态、按需</strong>指定。因此，和关系型数据库相比，HBase能够轻松应对字段变更的场景。</p>
<blockquote>
<p>3）Row</p>
</blockquote>
<p>HBase表中的每行数据都由一个<strong>RowKey和多个Column</strong>（列）组成，数据是按照RowKey的<strong>字典顺序存储</strong>的，并且查询数据时只能根据RowKey进行检索，所以RowKey的设计十分重要。</p>
<blockquote>
<p>4）Column</p>
</blockquote>
<p>HBase中的每个列都由<strong>ColumnFamily(列族)和ColumnQualifier（列限定符）</strong>进行限定，例如info：name，info：age。建表时，只需指明列族，而列限定符无需预先定义。</p>
<blockquote>
<p>5）TimeStamp</p>
</blockquote>
<p>用于标识数据的不同版本（version），每条数据写入时，如果不指定时间戳，系统会自动为其加上该字段，其值为写入HBase的时间。</p>
<blockquote>
<p>6）Cell</p>
</blockquote>
<p>由{rowkey,columnFamily：columnQualifier,timeStamp}唯一确定的单元。cell中的数据是没有类型的，全部是字节码形式存贮。</p>
<h2 id="1-3HBase基本架构"><a href="#1-3HBase基本架构" class="headerlink" title="1.3HBase基本架构"></a>1.3HBase基本架构</h2><p><strong>不完整版</strong></p>
<p><img src="/.com//image-20211216192508134.png" alt="image-20211216192508134"></p>
<p>架构角色：</p>
<blockquote>
<p>1）RegionServer</p>
</blockquote>
<p>RegionServer为Region的管理者，其实现类为HRegionServer，主要作用如下:对于数据的操作：get,put,delete；对于Region的操作：splitRegion、compactRegion。</p>
<blockquote>
<p>2）Master</p>
</blockquote>
<p>Master是所有RegionServer的管理者，其实现类为HMaster，主要作用如下：对于表的操作：create,delete,alter对于RegionServer的操作：分配regions到每个RegionServer，监控每个RegionServer的状态，负载均衡和故障转移。</p>
<blockquote>
<p>3）Zookeeper</p>
</blockquote>
<p>HBase通过Zookeeper来做Master的高可用、RegionServer的监控、元数据的入口以及集群配置的维护等工作。</p>
<blockquote>
<p>4）HDFS</p>
</blockquote>
<p>HDFS为HBase提供最终的底层数据存储服务，同时为HBase提供高可用的支持。</p>
<h1 id="第2章HBase快速入门"><a href="#第2章HBase快速入门" class="headerlink" title="第2章HBase快速入门"></a>第2章HBase快速入门</h1><h2 id="2-1HBase安装部署"><a href="#2-1HBase安装部署" class="headerlink" title="2.1HBase安装部署"></a>2.1HBase安装部署</h2><h3 id="2-1-1Zookeeper正常部署"><a href="#2-1-1Zookeeper正常部署" class="headerlink" title="2.1.1Zookeeper正常部署"></a>2.1.1Zookeeper正常部署</h3><p>首先保证Zookeeper集群的正常部署，并启动之：</p>
<p>创建集群启动脚本：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_">case$</span><span class="language-bash">1in</span></span><br><span class="line">&quot;start&quot;)&#123;</span><br><span class="line">foriinhadoop100hadoop101hadoop102</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">echo----------zookeeper$</span><span class="language-bash">i启动------------</span></span><br><span class="line"><span class="meta prompt_">ssh$</span><span class="language-bash">i<span class="string">&quot;/opt/module/zookeeper-3.4.10/bin/zkServer.shstart&quot;</span></span></span><br><span class="line">done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;stop&quot;)&#123;</span><br><span class="line">foriinhadoop100hadoop101hadoop102</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">echo----------zookeeper$</span><span class="language-bash">i停止------------</span></span><br><span class="line"><span class="meta prompt_">ssh$</span><span class="language-bash">i<span class="string">&quot;/opt/module/zookeeper-3.4.10/bin/zkServer.shstop&quot;</span></span></span><br><span class="line">done</span><br><span class="line">&#125;;;</span><br><span class="line">&quot;status&quot;)&#123;</span><br><span class="line">foriinhadoop100hadoop101hadoop102</span><br><span class="line">do</span><br><span class="line"><span class="meta prompt_">echo----------zookeeper$</span><span class="language-bash">i状态------------</span></span><br><span class="line"><span class="meta prompt_">ssh$</span><span class="language-bash">i<span class="string">&quot;/opt/module/zookeeper-3.4.10/bin/zkServer.shstatus&quot;</span></span></span><br><span class="line">done</span><br><span class="line">&#125;;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>



<h3 id="2-1-2Hadoop正常部署"><a href="#2-1-2Hadoop正常部署" class="headerlink" title="2.1.2Hadoop正常部署"></a>2.1.2Hadoop正常部署</h3><p>Hadoop集群的正常部署并启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102hadoop-2.7.2]<span class="variable">$sbin</span>/start-dfs.sh</span><br><span class="line">[atguigu@hadoop103hadoop-2.7.2]<span class="variable">$sbin</span>/start-yarn.sh</span><br></pre></td></tr></table></figure>



<h3 id="2-1-3HBase的解压"><a href="#2-1-3HBase的解压" class="headerlink" title="2.1.3HBase的解压"></a>2.1.3HBase的解压</h3><p>解压Hbase到指定目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102software]<span class="variable">$tar</span>-zxvfhbase-1.3.1-bin.tar.gz-C/opt/module</span><br></pre></td></tr></table></figure>



<h3 id="2-1-4HBase的配置文件"><a href="#2-1-4HBase的配置文件" class="headerlink" title="2.1.4HBase的配置文件"></a>2.1.4HBase的配置文件</h3><p>修改HBase对应的配置文件。</p>
<blockquote>
<p>1）hbase-env.sh修改内容：</p>
</blockquote>
<p>先获取自己环境的java信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop100conf]$<span class="built_in">echo</span><span class="variable">$JAVA_HOME</span></span><br><span class="line">/opt/module/jdk1.8.0_161</span><br></pre></td></tr></table></figure>

<p>注释下面的信息：</p>
<p><img src="/.com//image-20211217193750433.png" alt="image-20211217193750433"></p>
<p>修改一下信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/module/jdk1.8.0_161</span><br><span class="line"><span class="built_in">export</span> HBASE_MANAGES_ZK=<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>2）hbase-site.xml修改内容：</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xmlversion=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop100:8020/HBase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--0.98后的新变动，之前版本没有.port,默认端口为60000--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>16000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop100,hadoop101,hadoop102<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.zookeeper.property.dataDir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/module/zookeeper-3.4.10/zkData<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>3）regionservers：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop100</span><br><span class="line">hadoop101</span><br><span class="line">hadoop102</span><br></pre></td></tr></table></figure>

<blockquote>
<p>4）软连接hadoop配置文件到HBase：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102module]<span class="variable">$ln</span> -s /opt/module/hadoop-3.1.3/etc/hadoop/core-site.xml/opt/module/hbase-1.3.1/conf/core-site.xml</span><br><span class="line">[atguigu@hadoop102module]<span class="variable">$ln</span> -s /opt/module/hadoop-3.1.3/etc/hadoop/hdfs-site.xml/opt/module/hbase-1.3.1/conf/hdfs-site.xml</span><br></pre></td></tr></table></figure>

<p>可以看到两个文件都做好了引用：</p>
<p><img src="/.com//image-20211217200559717.png" alt="image-20211217200559717"></p>
<h3 id="2-1-5HBase远程发送到其他集群"><a href="#2-1-5HBase远程发送到其他集群" class="headerlink" title="2.1.5HBase远程发送到其他集群"></a>2.1.5HBase远程发送到其他集群</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop100module]<span class="variable">$xsync</span>.sh hbase-1.3.1</span><br></pre></td></tr></table></figure>



<h3 id="2-1-6HBase服务的启动"><a href="#2-1-6HBase服务的启动" class="headerlink" title="2.1.6HBase服务的启动"></a>2.1.6HBase服务的启动</h3><blockquote>
<p>1．启动方式</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop100 hbase-1.3.1]<span class="variable">$bin</span>/hbase-daemon.sh start master</span><br><span class="line">startingmaster,loggingto/opt/module/hbase-1.3.1/bin/../logs/hbase-atguigu-master-hadoop100.out</span><br><span class="line">[atguigu@hadoop100 hbase-1.3.1]<span class="variable">$bin</span>/hbase-daemon.sh start regionserver</span><br><span class="line">startingregionserver,loggingto/opt/module/hbase-1.3.1/bin/../logs/hbase-atguigu-regionserver-hadoop100.out</span><br></pre></td></tr></table></figure>

<p>提示：如果集群之间的节点时间不同步，会导致regionserver无法启动，抛出ClockOutOfSyncException异常。修复提示：</p>
<p>a、同步时间服务请参看帮助文档：《尚硅谷大数据技术之Hadoop入门》</p>
<p>b、属性：hbase.master.maxclockskew设置更大的值</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.master.maxclockskew<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>180000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Timedifferenceofregionserverfrommaster<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>2．启动方式</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop100hbase-1.3.1]<span class="variable">$bin</span>/start-hbase.sh</span><br><span class="line">startingmaster,loggingto/opt/module/hbase-1.3.1/bin/../logs/hbase-atguigu-master-hadoop100.out</span><br><span class="line">hadoop101:startingregionserver,loggingto/opt/module/hbase-1.3.1/bin/../logs/hbase-atguigu-regionserver-hadoop101.out</span><br><span class="line">hadoop102:startingregionserver,loggingto/opt/module/hbase-1.3.1/bin/../logs/hbase-atguigu-regionserver-hadoop102.out</span><br><span class="line">hadoop100:startingregionserver,loggingto/opt/module/hbase-1.3.1/bin/../logs/hbase-atguigu-regionserver-hadoop100.out</span><br></pre></td></tr></table></figure>

<p>对应的停止服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop100hbase-1.3.1]<span class="variable">$bin</span>/stop-hbase.sh</span><br><span class="line">stoppinghbase.......................</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20211217202137524.png" alt="image-20211217202137524"></p>
<h2 id="2-2HBaseShell操作"><a href="#2-2HBaseShell操作" class="headerlink" title="2.2HBaseShell操作"></a>2.2HBaseShell操作</h2><h3 id="2-2-1基本操作"><a href="#2-2-1基本操作" class="headerlink" title="2.2.1基本操作"></a>2.2.1基本操作</h3><blockquote>
<p>1．进入HBase客户端命令行</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop100hbase-1.3.1]<span class="variable">$bin</span>/hbaseshell</span><br></pre></td></tr></table></figure>



<blockquote>
<p>2．查看帮助命令</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):001:0&gt;<span class="built_in">help</span></span><br><span class="line">HBaseShell,version1.3.1,r930b9a55528fe45d8edce7af42fef2d35e77677a,ThuApr619:36:54PDT2017</span><br><span class="line">Type<span class="string">&#x27;help&quot;COMMAND&quot;&#x27;</span>,(e.g.<span class="string">&#x27;help&quot;get&quot;&#x27;</span>--thequotesarenecessary)forhelponaspecificcommand.</span><br><span class="line">Commandsaregrouped.Type<span class="string">&#x27;help&quot;COMMAND_GROUP&quot;&#x27;</span>,(e.g.<span class="string">&#x27;help&quot;general&quot;&#x27;</span>)forhelponacommandgroup.</span><br><span class="line"></span><br><span class="line">COMMANDGROUPS:</span><br><span class="line">Groupname:general</span><br><span class="line">Commands:status,table_help,version,<span class="built_in">whoami</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Groupname:ddl</span></span><br><span class="line"><span class="comment">#Commands:alter,alter_async,alter_status,create,describe,disable,disable_all,drop,drop_all,enable,enable_all,exists,get_table,is_disabled,is_enabled,list,locate_region,show_filters</span></span><br><span class="line"></span><br><span class="line">Groupname:namespace</span><br><span class="line">Commands:alter_namespace,create_namespace,describe_namespace,drop_namespace,list_namespace,list_namespace_tables</span><br><span class="line"></span><br><span class="line"><span class="comment">#Groupname:dml</span></span><br><span class="line"><span class="comment">#Commands:append,count,delete,deleteall,get,get_counter,get_splits,incr,put,scan,truncate,truncate_preserve</span></span><br><span class="line"></span><br><span class="line">Groupname:tools</span><br><span class="line">Commands:assign,balance_switch,balancer,balancer_enabled,catalogjanitor_enabled,catalogjanitor_run,catalogjanitor_switch,close_region,compact,compact_rs,flush,major_compact,merge_region,move,normalize,normalizer_enabled,normalizer_switch,<span class="built_in">split</span>,splitormerge_enabled,splitormerge_switch,trace,unassign,wal_roll,zk_dump</span><br><span class="line"></span><br><span class="line">Groupname:replication</span><br><span class="line">Commands:add_peer,append_peer_tableCFs,disable_peer,disable_table_replication,enable_peer,enable_table_replication,get_peer_config,list_peer_configs,list_peers,list_replicated_tables,remove_peer,remove_peer_tableCFs,set_peer_tableCFs,show_peer_tableCFs</span><br><span class="line"></span><br><span class="line">Groupname:snapshots</span><br><span class="line">Commands:clone_snapshot,delete_all_snapshot,delete_snapshot,delete_table_snapshots,list_snapshots,list_table_snapshots,restore_snapshot,snapshot</span><br><span class="line"></span><br><span class="line">Groupname:configuration</span><br><span class="line">Commands:update_all_config,update_config</span><br><span class="line"></span><br><span class="line">Groupname:quotas</span><br><span class="line">Commands:list_quotas,set_quota</span><br><span class="line"></span><br><span class="line">Groupname:security</span><br><span class="line">Commands:grant,list_security_capabilities,revoke,user_permission</span><br><span class="line"></span><br><span class="line">Groupname:procedures</span><br><span class="line">Commands:abort_procedure,list_procedures</span><br><span class="line"></span><br><span class="line">Groupname:visibilitylabels</span><br><span class="line">Commands:add_labels,clear_auths,get_auths,list_labels,set_auths,set_visibility</span><br><span class="line"></span><br><span class="line">SHELLUSAGE:</span><br><span class="line">QuoteallnamesinHBaseShellsuchastableandcolumnnames.Commasdelimit</span><br><span class="line">commandparameters.Type&lt;RETURN&gt;afterenteringacommandtorunit.</span><br><span class="line">Dictionariesofconfigurationusedinthecreationandalterationoftablesare</span><br><span class="line">RubyHashes.Theylooklikethis:</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;key1&#x27;</span>=&gt;<span class="string">&#x27;value1&#x27;</span>,<span class="string">&#x27;key2&#x27;</span>=&gt;<span class="string">&#x27;value2&#x27;</span>,...&#125;</span><br><span class="line"></span><br><span class="line">andareopenedandclosedwithcurley-braces.Key/valuesaredelimitedbythe</span><br><span class="line"><span class="string">&#x27;=&gt;&#x27;</span>charactercombination.Usuallykeysarepredefinedconstantssuchas</span><br><span class="line">NAME,VERSIONS,COMPRESSION,etc.Constantsdonotneedtobequoted.Type</span><br><span class="line"><span class="string">&#x27;Object.constants&#x27;</span>toseea(messy)listofallconstantsintheenvironment.</span><br><span class="line"></span><br><span class="line">Ifyouareusingbinarykeysorvaluesandneedtoenterthemintheshell,use</span><br><span class="line">double-quote<span class="string">&#x27;dhexadecimalrepresentation.Forexample:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hbase&gt;get&#x27;</span>t1<span class="string">&#x27;,&quot;key\x03\x3f\xcd&quot;</span></span><br><span class="line"><span class="string">hbase&gt;get&#x27;</span>t1<span class="string">&#x27;,&quot;key\003\023\011&quot;</span></span><br><span class="line"><span class="string">hbase&gt;put&#x27;</span>t1<span class="string">&#x27;,&quot;test\xef\xff&quot;,&#x27;</span>f1:<span class="string">&#x27;,&quot;\x01\x33\x40&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">TheHBaseshellisthe(J)RubyIRBwiththeaboveHBase-specificcommandsadded.</span></span><br><span class="line"><span class="string">FormoreontheHBaseShell,seehttp://hbase.apache.org/book.html</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>3．查看当前数据库中有哪些表</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">002</span>:<span class="number">0</span><span class="operator">&gt;</span>list</span><br><span class="line"><span class="keyword">TABLE</span></span><br><span class="line"><span class="number">0</span><span class="type">row</span>(s)in0<span class="number">.6350</span>seconds</span><br><span class="line"></span><br><span class="line"><span class="operator">=</span><span class="operator">&gt;</span>[]</span><br></pre></td></tr></table></figure>



<h3 id="2-2-2表的操作"><a href="#2-2-2表的操作" class="headerlink" title="2.2.2表的操作"></a>2.2.2表的操作</h3><p><strong>1．创建表</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):003:0&gt;create<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;info&#x27;</span></span><br><span class="line">0row(s)in2.4680seconds</span><br><span class="line"></span><br><span class="line">=&gt;Hbase::Table-student</span><br><span class="line">hbase(main):004:0&gt;create<span class="string">&#x27;stu&#x27;</span>,<span class="string">&#x27;info1&#x27;</span>,<span class="string">&#x27;info2&#x27;</span></span><br><span class="line">0row(s)in1.2800seconds</span><br><span class="line"></span><br><span class="line">=&gt;Hbase::Table-stu</span><br><span class="line">hbase(main):005:0&gt;list</span><br><span class="line">TABLE</span><br><span class="line">stu</span><br><span class="line">student</span><br><span class="line">2row(s)in0.0200seconds</span><br><span class="line"></span><br><span class="line">=&gt;[<span class="string">&quot;stu&quot;</span>,<span class="string">&quot;student&quot;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>2．插入数据到表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">003</span>:<span class="number">0</span><span class="operator">&gt;</span>put<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1001&#x27;</span>,<span class="string">&#x27;info:sex&#x27;</span>,<span class="string">&#x27;male&#x27;</span></span><br><span class="line">hbase(main):<span class="number">004</span>:<span class="number">0</span><span class="operator">&gt;</span>put<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1001&#x27;</span>,<span class="string">&#x27;info:age&#x27;</span>,<span class="string">&#x27;18&#x27;</span></span><br><span class="line">hbase(main):<span class="number">005</span>:<span class="number">0</span><span class="operator">&gt;</span>put<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1002&#x27;</span>,<span class="string">&#x27;info:name&#x27;</span>,<span class="string">&#x27;Janna&#x27;</span></span><br><span class="line">hbase(main):<span class="number">006</span>:<span class="number">0</span><span class="operator">&gt;</span>put<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1002&#x27;</span>,<span class="string">&#x27;info:sex&#x27;</span>,<span class="string">&#x27;female&#x27;</span></span><br><span class="line">hbase(main):<span class="number">007</span>:<span class="number">0</span><span class="operator">&gt;</span>put<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1002&#x27;</span>,<span class="string">&#x27;info:age&#x27;</span>,<span class="string">&#x27;20&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>3．扫描查看表数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">008</span>:<span class="number">0</span><span class="operator">&gt;</span>scan<span class="string">&#x27;student&#x27;</span></span><br><span class="line">hbase(main):<span class="number">009</span>:<span class="number">0</span><span class="operator">&gt;</span>scan<span class="string">&#x27;student&#x27;</span>,&#123;STARTROW<span class="operator">=</span><span class="operator">&gt;</span><span class="string">&#x27;1001&#x27;</span>,STOPROW<span class="operator">=</span><span class="operator">&gt;</span><span class="string">&#x27;1001&#x27;</span>&#125;</span><br><span class="line">hbase(main):<span class="number">010</span>:<span class="number">0</span><span class="operator">&gt;</span>scan<span class="string">&#x27;student&#x27;</span>,&#123;STARTROW<span class="operator">=</span><span class="operator">&gt;</span><span class="string">&#x27;1001&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4．查看表结构</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">describe</span>‘student’</span><br></pre></td></tr></table></figure>

<p><strong>5．更新指定字段的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">012</span>:<span class="number">0</span><span class="operator">&gt;</span>put<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1001&#x27;</span>,<span class="string">&#x27;info:name&#x27;</span>,<span class="string">&#x27;Nick&#x27;</span></span><br><span class="line">hbase(main):<span class="number">013</span>:<span class="number">0</span><span class="operator">&gt;</span>put<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1001&#x27;</span>,<span class="string">&#x27;info:age&#x27;</span>,<span class="string">&#x27;100&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>6．查看“指定行”或“指定列族:列”的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">014</span>:<span class="number">0</span><span class="operator">&gt;</span><span class="keyword">get</span><span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1001&#x27;</span></span><br><span class="line">hbase(main):<span class="number">015</span>:<span class="number">0</span><span class="operator">&gt;</span><span class="keyword">get</span><span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1001&#x27;</span>,<span class="string">&#x27;info:name&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>7．统计表数据行数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">021</span>:<span class="number">0</span><span class="operator">&gt;</span>count<span class="string">&#x27;student&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>8．删除数据</strong></p>
<p>删除某rowkey的全部数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">016</span>:<span class="number">0</span><span class="operator">&gt;</span>deleteall<span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1001&#x27;</span></span><br></pre></td></tr></table></figure>

<p>删除某rowkey的某一列数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">017</span>:<span class="number">0</span><span class="operator">&gt;</span><span class="keyword">delete</span><span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1002&#x27;</span>,<span class="string">&#x27;info:sex&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>9．清空表数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">018</span>:<span class="number">0</span><span class="operator">&gt;</span><span class="keyword">truncate</span><span class="string">&#x27;student&#x27;</span></span><br></pre></td></tr></table></figure>



<p>提示：清空表的操作顺序为先disable，然后再truncate。</p>
<p><strong>10．删除表</strong></p>
<p>首先需要先让该表为disable状态：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">019</span>:<span class="number">0</span><span class="operator">&gt;</span>disable<span class="string">&#x27;student&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后才能drop这个表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">020</span>:<span class="number">0</span><span class="operator">&gt;</span><span class="keyword">drop</span><span class="string">&#x27;student&#x27;</span></span><br></pre></td></tr></table></figure>

<p>提示：如果直接drop表，会报错：ERROR:Tablestudentisenabled.Disableitfirst.</p>
<p><strong>11．变更表信息</strong></p>
<p>将info列族中的数据存放3个版本：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):<span class="number">022</span>:<span class="number">0</span><span class="operator">&gt;</span><span class="keyword">alter</span><span class="string">&#x27;student&#x27;</span>,&#123;NAME<span class="operator">=</span><span class="operator">&gt;</span><span class="string">&#x27;info&#x27;</span>,VERSIONS<span class="operator">=</span><span class="operator">&gt;</span><span class="number">3</span>&#125;</span><br><span class="line">hbase(main):<span class="number">022</span>:<span class="number">0</span><span class="operator">&gt;</span><span class="keyword">get</span><span class="string">&#x27;student&#x27;</span>,<span class="string">&#x27;1001&#x27;</span>,&#123;<span class="keyword">COLUMN</span><span class="operator">=</span><span class="operator">&gt;</span><span class="string">&#x27;info:name&#x27;</span>,VERSIONS<span class="operator">=</span><span class="operator">&gt;</span><span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>





<h1 id="第3章HBase进阶"><a href="#第3章HBase进阶" class="headerlink" title="第3章HBase进阶"></a>第3章HBase进阶</h1><h2 id="3-1架构原理"><a href="#3-1架构原理" class="headerlink" title="3.1架构原理"></a>3.1架构原理</h2><p><img src="/.com//image-20211222192554288.png" alt="image-20211222192554288"></p>
<blockquote>
<p>1）StoreFile</p>
</blockquote>
<p>保存实际数据的物理文件，StoreFile以HFile的形式存储在HDFS上。每个Store会有一个或多个StoreFile（HFile），数据在每个StoreFile中都是有序的。</p>
<blockquote>
<p>2）MemStore</p>
</blockquote>
<p>写缓存，由于HFile中的数据要求是有序的，所以数据是先存储在MemStore中，排好序后，等到达刷写时机才会刷写到HFile，每次刷写都会形成一个新的HFile。</p>
<blockquote>
<p>3）WAL</p>
</blockquote>
<p>由于数据要经MemStore排序后才能刷写到HFile，但把数据保存在内存中会有很高的概率导致数据丢失，为了解决这个问题，数据会先写在一个叫做Write-Aheadlogfile的文件中，然后再写入MemStore中。所以在系统出现故障的时候，数据可以通过这个日志文件重建。</p>
<h2 id="3-2写流程"><a href="#3-2写流程" class="headerlink" title="3.2写流程"></a>3.2写流程</h2><p><img src="/.com//image-20211222194908329.png" alt="image-20211222194908329"></p>
<p>写流程：</p>
<p>1）Client先访问zookeeper，获取hbase:meta表位于哪个RegionServer。</p>
<p>2）访问对应的RegionServer，获取hbase:meta表，根据读请求的namespace:table&#x2F;rowkey，查询出目标数据位于哪个RegionServer中的哪个Region中。并将该table的region信息以及meta表的位置信息缓存在客户端的metacache，方便下次访问。</p>
<p>3）与目标RegionServer进行通讯；</p>
<p>4）将数据顺序写入（追加）到WAL；</p>
<p>5）将数据写入对应的MemStore，数据会在MemStore进行排序；</p>
<p>6）向客户端发送ack；</p>
<p>7）等达到MemStore的刷写时机后，将数据刷写到HFile。</p>
<p><strong>详看HaBase16集源码写操作解读</strong></p>
<h2 id="3-3-MemStoreFlush"><a href="#3-3-MemStoreFlush" class="headerlink" title="3.3 MemStoreFlush"></a>3.3 MemStoreFlush</h2><p><img src="/.com//image-20220115103512091.png" alt="image-20220115103512091"></p>
<p>MemStore刷写时机（要记住开始往memstore和停止mestore刷写的时机。）：</p>
<ol>
<li><p><strong>单个Store来看</strong> memstroe 的大小达到了hbase.hregion.memstore.flush.size（默认值128M），其所在region的所有memstore都会刷写。当memstore的大小达到了hbase.hregion.memstore.flush.size（默认值128M）* hbase.hregion.memstore.block.multiplier（默认值4）时，会阻止继续往该memstore写数据。</p>
</li>
<li><p><strong>从regionerServer中来看</strong>regionserver中memstore的总大小达到java_heapsize*hbase.regionserver.global.memstore.size（默认值0.4)*hbase.regionserver.global.memstore.size.lower.limit（默认值0.95），region会按照其所有memstore的大小顺序（由大到小）依次进行刷写。直到regionserver中所有memstore的总大小减小到上述值以下。当 regionserver 中 memstore 的总大小达到 java_heapsize*hbase.regionserver.global.memstore.size（默认值0.4）时，会阻止继续往所有的memstore写数据。</p>
</li>
<li><p>到达自动刷写的时间，也会触发memstoreflush。自动刷新的时间间隔由该属性进行配置hbase.regionserver.optionalcacheflushinterval（默认1小时）。</p>
</li>
<li><p>当 WAL 文件的数量超过 hbase.regionserver.max.logs，region 会按照<strong>时间顺序依次进 行刷写</strong>，直到 WAL 文件数量减小到 hbase.regionserver.max.log 以下（该属性名已经废弃， 现无需手动设置，最大值为 32）。</p>
</li>
</ol>
<h2 id="3-4-读流程"><a href="#3-4-读流程" class="headerlink" title="3.4 读流程"></a>3.4 读流程</h2><p><img src="/.com//image-20220115104721683.png" alt="image-20220115104721683"></p>
<p><strong>读流程</strong> ：发送Get请求，磁盘和内存一起读，为了加速磁盘的读速度，加了一个Block Cache</p>
<p>1）Client 先访问 zookeeper，获取 hbase:meta 表位于哪个 Region Server。 </p>
<p>2）访问对应的 Region Server，获取 hbase:meta 表，根据读请求的 namespace:table&#x2F;rowkey， 查询出目标数据位于哪个 Region Server 中的哪个 Region 中。并将该 table 的 region 信息以 及 meta 表的位置信息缓存在客户端的 meta cache，方便下次访问。 </p>
<p>3）与目标 Region Server 进行通讯； </p>
<p>4）分别在 Block Cache（读缓存），MemStore 和 Store File（HFile）中查询目标数据，并将查到的所有数据进行合并。此处所有数据是指同一条数据的不同版本（time stamp）或者不同的类型（Put&#x2F;Delete）。 </p>
<p>5） 将从文件中查询到的数据块（Block，HFile 数据存储单元，默认大小为 64KB）缓存到 Block Cache。 </p>
<p>6）将合并后的最终结果返回给客户端。</p>
<h2 id="3-5-StoreFile-Compaction"><a href="#3-5-StoreFile-Compaction" class="headerlink" title="3.5 StoreFile Compaction"></a>3.5 StoreFile Compaction</h2><p>由于memstore每次刷写都会生成一个新的HFile，且同一个字段的不同版本（timestamp） 和不同类型（Put&#x2F;Delete）有可能会分布在不同的 HFile 中，因此查询时需要遍历所有的 HFile。</p>
<p>为了减少 HFile 的个数，以及清理掉过期和删除的数据，会进行 StoreFile Compaction。 Compaction 分为两种，分别是 <strong>Minor Compaction 和 Major Compaction</strong>。Minor Compaction 会将临近的若干个较小的 HFile 合并成一个较大的 HFile，但<strong>不会清理过期和删除的数据</strong>。 Major Compaction 会将一个 Store 下的所有的 HFile 合并成一个大 HFile，并且会清理掉过期 和删除的数据。</p>
<p><img src="/.com//image-20220115114148857.png" alt="image-20220115114148857"></p>
<h2 id="3-6-Region-Split"><a href="#3-6-Region-Split" class="headerlink" title="3.6 Region Split"></a>3.6 Region Split</h2><p>默认情况下，每个Table 起初只有一个 Region，随着数据的不断写入，Region 会自动进行拆分。刚拆分时，两个子 Region 都位于当前的 Region Server，但处于负载均衡的考虑， HMaster 有可能会将某个 Region 转移给其他的 Region Server。</p>
<p>Region Split 时机： </p>
<p>1.当1个region中的某个Store下所有StoreFile的总大小超过<strong>hbase.hregion.max.filesize</strong>， 该 Region 就会进行拆分（0.94 版本之前）。 </p>
<p>2.当 1 个 region 中 的 某 个 Store 下所有 StoreFile 的 总 大 小 超 过 **Min(R^2 *  “hbase.hregion.memstore.flush.size”,hbase.hregion.max.filesize”)**，该 Region 就会进行拆分，其 中 R 为当前 Region Server 中属于该 Table 的个数（0.94 版本之后）。</p>
<p><img src="/.com//image-20220115125847548.png" alt="image-20220115125847548"></p>
<h1 id="第-4-章-HBase-API"><a href="#第-4-章-HBase-API" class="headerlink" title="第 4 章 HBase API"></a>第 4 章 HBase API</h1><h2 id="4-1-环境准备"><a href="#4-1-环境准备" class="headerlink" title="4.1 环境准备"></a>4.1 环境准备</h2><p><img src="/.com//image-20220115130630505.png" alt="image-20220115130630505"></p>
<p>新建项目后在 pom.xml 中添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-2-HBaseAPI"><a href="#4-2-HBaseAPI" class="headerlink" title="4.2 HBaseAPI"></a>4.2 HBaseAPI</h2><h3 id="4-2-1-获取-Configuration-对象"><a href="#4-2-1-获取-Configuration-对象" class="headerlink" title="4.2.1 获取 Configuration 对象"></a>4.2.1 获取 Configuration 对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//1. 获取配置信息</span></span><br><span class="line">           <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> HBaseConfiguration.create();</span><br><span class="line"></span><br><span class="line">           <span class="comment">//2. 创建连接对象</span></span><br><span class="line">           connection = ConnectionFactory.createConnection(configuration);</span><br><span class="line"></span><br><span class="line">           <span class="comment">//3. 创建admin对象</span></span><br><span class="line">           admin = connection.getAdmin();</span><br><span class="line">       &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-判断表是否存在"><a href="#4-2-2-判断表是否存在" class="headerlink" title="4.2.2 判断表是否存在"></a>4.2.2 判断表是否存在</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.判断表明是否存在</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isTableExistByNewFun</span><span class="params">(String tableName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//3. 判断表是否存在</span></span><br><span class="line">       <span class="keyword">return</span> admin.tableExists(TableName.valueOf(tableName));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-2-3-DDL"><a href="#4-2-3-DDL" class="headerlink" title="4.2.3 DDL"></a>4.2.3 DDL</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.DDL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.HbaseAPI;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.test;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Admin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2022-01-15-时间:13:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">createTable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">createTable</span> <span class="variable">table</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">createTable</span>();</span><br><span class="line"></span><br><span class="line">        System.out.println(HbaseAPI.isTableExistByNewFun(<span class="string">&quot;0408:stu5&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建表测试,在命名空间0408下面创建表</span></span><br><span class="line">        table.createTable(<span class="string">&quot;0408:stu5&quot;</span>,<span class="string">&quot;info1&quot;</span>,<span class="string">&quot;info2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(HbaseAPI.isTableExistByNewFun(<span class="string">&quot;0408:stu5&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*//2.删除表</span></span><br><span class="line"><span class="comment">        table.dropTable(&quot;stu5&quot;);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.创建命名空间 hbase(main):004:0&gt; list_namespace</span></span><br><span class="line">        <span class="comment">//NAMESPACE</span></span><br><span class="line">        <span class="comment">//0408</span></span><br><span class="line">        <span class="comment">//default</span></span><br><span class="line">        <span class="comment">//hbase</span></span><br><span class="line">        <span class="comment">//3 row(s) in 0.3890 seconds</span></span><br><span class="line">        table.createNameSpace(<span class="string">&quot;0408&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.关闭资源</span></span><br><span class="line">        HbaseAPI.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.创建表</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createTable</span> <span class="params">(String tableName , String... cfs)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1.判断是否存在列族信息</span></span><br><span class="line">        <span class="keyword">if</span> (cfs.length &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;请设置列族信息&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 判断表是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (HbaseAPI.isTableExistByNewFun(tableName))&#123;</span><br><span class="line">            System.out.println(tableName + <span class="string">&quot;表已存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.5 创建表描述器</span></span><br><span class="line">        <span class="type">HTableDescriptor</span> <span class="variable">hTableDescriptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HTableDescriptor</span>(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.6 循环添加列族信息</span></span><br><span class="line">        <span class="keyword">for</span> (String cf : cfs) &#123;</span><br><span class="line">            <span class="comment">//2.7 创建列族描述器</span></span><br><span class="line">            <span class="type">HColumnDescriptor</span> <span class="variable">hColumnDescriptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HColumnDescriptor</span>(cf);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.8 添加具体的列族信息</span></span><br><span class="line">            hTableDescriptor.addFamily(hColumnDescriptor);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.创建表</span></span><br><span class="line">        HbaseAPI.admin.createTable(hTableDescriptor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.删除表</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dropTable</span> <span class="params">(String tableName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;++++++++++++++++++++表的删除操作++++++++++++++++&quot;</span>);</span><br><span class="line">        <span class="comment">//1.先判断表是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (HbaseAPI.isTableExistByNewFun(tableName))&#123;</span><br><span class="line">            System.out.println(tableName+<span class="string">&quot;: 表存在&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(tableName+<span class="string">&quot;:不存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 使表下线</span></span><br><span class="line">        HbaseAPI.admin.disableTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.删除表</span></span><br><span class="line">        HbaseAPI.admin.deleteTable(TableName.valueOf(tableName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 创建命名空间</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createNameSpace</span><span class="params">(String ns)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.创建命令空间描述器</span></span><br><span class="line">        <span class="type">NamespaceDescriptor</span> <span class="variable">namespaceDescriptor</span> <span class="operator">=</span> NamespaceDescriptor.create(ns).build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.创建命名空间</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            HbaseAPI.admin.createNamespace(namespaceDescriptor);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (NamespaceExistException e)&#123;</span><br><span class="line">            System.out.println(ns+<span class="string">&quot;:命名空间已存在&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;命名空间存在，方法运行结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="4-2-4-DDL"><a href="#4-2-4-DDL" class="headerlink" title="4.2.4 DDL"></a>4.2.4 DDL</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.DML;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.HbaseAPI;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.Cell;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.CellUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.TableName;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2022-01-15-时间:14:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Table_DML</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Table_DML</span> <span class="variable">table</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Table_DML</span>();</span><br><span class="line">        <span class="comment">/*//1.创建数据测试</span></span><br><span class="line"><span class="comment">        table.putData(&quot;stu&quot;,&quot;1002&quot;,&quot;info&quot;,&quot;name&quot;,&quot;TS&quot;);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.获取单行数据</span></span><br><span class="line">        <span class="comment">/*table.getData(&quot;stu&quot;,&quot;1001&quot;,&quot;info&quot;,&quot;name&quot;);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.查询表中的数据</span></span><br><span class="line">        <span class="comment">/*table.ScanData(&quot;stu&quot;);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.测试删除</span></span><br><span class="line">        table.deleteData(<span class="string">&quot;stu&quot;</span>,<span class="string">&quot;1006&quot;</span>,<span class="string">&quot;info&quot;</span>,<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        HbaseAPI.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.向表内插入数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putData</span><span class="params">(String tableName,String rowKey , String cf , String cn , String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1.获取表对象</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> HbaseAPI.connection.getTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.创建put对象</span></span><br><span class="line">        <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.给put对象赋值</span></span><br><span class="line">        put.addColumn(Bytes.toBytes(cf),Bytes.toBytes(cn),Bytes.toBytes(value));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//多个数据插入</span></span><br><span class="line">        <span class="comment">//table.put(new List&lt;Put&gt;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.插入数据</span></span><br><span class="line">        table.put(put);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.获取数据（get）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getData</span><span class="params">(String tableName , String rowKey , String cf , String cn)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取表对象</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> HbaseAPI.connection.getTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.创建Get对象</span></span><br><span class="line">        <span class="type">Get</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Get</span>(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.1 指定获取的列族</span></span><br><span class="line">        get.addFamily(Bytes.toBytes(cf));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.2 指定列族和列</span></span><br><span class="line">        get.addColumn(Bytes.toBytes(cf),Bytes.toBytes(cn));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.3 设置获取数据的版本数</span></span><br><span class="line">        get.setMaxVersions();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.获取数据</span></span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> table.get(get);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.解析result并打印</span></span><br><span class="line">        <span class="keyword">for</span> (Cell cell : result.rawCells()) &#123;</span><br><span class="line">            <span class="comment">//5.打印数据</span></span><br><span class="line">            System.out.println( <span class="string">&quot;CF: &quot;</span> + Bytes.toString(CellUtil.cloneFamily(cell)) +</span><br><span class="line">                    <span class="string">&quot; CN: &quot;</span>+ Bytes.toString(CellUtil.cloneQualifier(cell)) +</span><br><span class="line">                    <span class="string">&quot; Value: &quot;</span>+ Bytes.toString(CellUtil.cloneValue(cell))</span><br><span class="line">                    );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.获取数据（scan）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ScanData</span> <span class="params">(String tableName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">         <span class="comment">//1.获取表的连接</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> HbaseAPI.connection.getTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 构建Scan对象</span></span><br><span class="line">        <span class="type">Scan</span> <span class="variable">scan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scan</span>();</span><br><span class="line">        <span class="comment">/*获取范围id的值*/</span></span><br><span class="line">        <span class="comment">//Scan scan = new Scan(Bytes.toBytes(&quot;1001&quot;),Bytes.toBytes(&quot;1003&quot;));</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.扫描表</span></span><br><span class="line">        <span class="type">ResultScanner</span> <span class="variable">resultScanner</span> <span class="operator">=</span> table.getScanner(scan);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.解析resultScanner</span></span><br><span class="line">        <span class="keyword">for</span> (Result result : resultScanner) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5.打印数据</span></span><br><span class="line">            <span class="keyword">for</span> (Cell cell : result.rawCells()) &#123;</span><br><span class="line">                <span class="comment">//5.打印数据</span></span><br><span class="line">                System.out.println( <span class="string">&quot;CF: &quot;</span> + Bytes.toString(CellUtil.cloneFamily(cell)) +</span><br><span class="line">                        <span class="string">&quot; CN: &quot;</span>+ Bytes.toString(CellUtil.cloneQualifier(cell)) +</span><br><span class="line">                        <span class="string">&quot; Value: &quot;</span>+ Bytes.toString(CellUtil.cloneValue(cell))</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.关闭资源</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.删除数据</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @author: 左先生</span></span><br><span class="line"><span class="comment">     * @date: 2022-01-15 17:08</span></span><br><span class="line"><span class="comment">     * @description:总结：</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteData</span><span class="params">(String tableName , String rowKey , String cf , String cn)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//1.获取表的连接</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> HbaseAPI.connection.getTable(TableName.valueOf(tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.构建删除对象</span></span><br><span class="line">        <span class="type">Delete</span> <span class="variable">delete</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Delete</span>(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.1 设置删除的列,该设置可以删除指定的info以及列信息，进行单个删除，里面的timestamp参数可加可不加</span></span><br><span class="line">        delete.addColumns(Bytes.toBytes(cf),Bytes.toBytes(cn),<span class="number">1642236880388L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.2 删除指定的列族</span></span><br><span class="line">        <span class="comment">//delete.addFamily(Bytes.toBytes(cf));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.执行删除操作</span></span><br><span class="line">        table.delete(delete);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.关闭连接</span></span><br><span class="line">        table.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="4-3-MapReduce"><a href="#4-3-MapReduce" class="headerlink" title="4.3 MapReduce"></a>4.3 MapReduce</h2><p>通过 HBase 的相关 JavaAPI，我们可以实现伴随 HBase 操作的 MapReduce 过程，比如使用 MapReduce 将数据从本地文件系统导入到 HBase 的表中，比如我们从 HBase 中读取一些原 始数据后使用 MapReduce 做数据分析。</p>
<h3 id="4-3-1-官方-HBase-MapReduce"><a href="#4-3-1-官方-HBase-MapReduce" class="headerlink" title="4.3.1 官方 HBase-MapReduce"></a>4.3.1 官方 HBase-MapReduce</h3><blockquote>
<p>1．查看 HBase 的 MapReduce 任务的执行 </p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop100 hbase-1.3.1]$ ./bin/hbase mapredcp</span><br><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/opt/module/hbase-1.3.1/lib/slf4j-log4j12-1.7.5.jar!/org/slf4jimpl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding <span class="keyword">in</span> [jar:file:/opt/module/hadoop-3.1.3/share/hadoop/common/lib/slf4j-log4j12-1.7.25.jar!/org/slf4jimpl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html<span class="comment">#multiple_bindings for an explanation.</span></span><br><span class="line">SLF4J: Actual binding is of <span class="built_in">type</span> [org.slf4j.impl.Log4jLoggerFactory]</span><br><span class="line">/opt/module/hbase-1.3.1/lib/zookeeper-3.4.6.jar:/opt/module/hbase-1.3.1/lib/guava-12.0.1.jar:/opt/module/hbase-1.3.1/lib/metrics-core-2.2.0.jar:/opt/module/hbase-1.3.1/lib/protobuf-java-2.5.0.jar:/opt/module/hbase-1.3.1/lib/hbase-common-1.3.1.jar:/opt/module/hbase-1.3.1/lib/hbase-protocol-1.3.1.jar:/opt/module/hbase-1.3.1/lib/htrace-core-3.1.0-incubating.jar:/opt/module/hbase-1.3.1/lib/hbase-client-1.3.1.jar:/opt/module/hbase-1.3.1/lib/hbase-hadoop-compat-1.3.1.jar:/opt/module/hbase-1.3.1/lib/netty-all-4.0.23.Final.jar:/opt/module/hbase-1.3.1/lib/hbase-server-1.3.1.jar:/opt/module/hbase-1.3.1/lib/hbase-prefix-tree-1.3.1.jar</span><br></pre></td></tr></table></figure>



<blockquote>
<p>2．环境变量的导入 </p>
</blockquote>
<p>（1）执行环境变量的导入（临时生效，在命令行执行下述操作）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> HBASE_HOME=/opt/module/hbase</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> HADOOP_HOME=/opt/module/hadoop-2.7.2</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> HADOOP_CLASSPATH=`<span class="variable">$&#123;HBASE_HOME&#125;</span>/bin/hbase mapredcp`</span></span><br></pre></td></tr></table></figure>

<p>（2）永久生效：在&#x2F;etc&#x2F;profile 配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export HBASE_HOME=/opt/module/hbase</span><br><span class="line">export HADOOP_HOME=/opt/module/hadoop-2.7.2</span><br></pre></td></tr></table></figure>

<p>并在 hadoop-env.sh 中配置：（注意：在 for 循环之后配） </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export HADOOP_CLASSPATH=$HADOOP_CLASSPATH:/opt/module/hbase-1.3.1/lib/*</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3．运行官方的 MapReduce 任务 – </p>
</blockquote>
<p>案例一：统计 Student 表中有多少行数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop101 hbase-1.3.1]$ /opt/module/hadoop-3.1.3/bin/yarn jar lib/hbase-server-1.3.1.jar rowcounter stu</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20220115204712264.png" alt="image-20220115204712264"></p>
<p>– 案例二：使用 MapReduce 将本地数据导入到 HBase </p>
<p>1）在本地创建一个 tsv 格式的文件：fruit.tsv（注意这里的分隔符是TAB键）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1001	Apple	Red</span><br><span class="line">1002	Pear	Yellow</span><br><span class="line">1003	Pineapple	Yellow</span><br></pre></td></tr></table></figure>

<p>3）上传到hadoop</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop101 hbase-1.3.1]$ hadoop fs -put fruit.tsv /</span><br></pre></td></tr></table></figure>

<p>4）执行 MapReduce 到 HBase 的 fruit 表中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/module/hadoop-3.1.3/bin/yarn jar lib/hbase-server-1.3.1.jar importtsv -Dimporttsv.columns=HBASE_ROW_KEY,info:name,info:color fruit hdfs://hadoop101:9000input_fruit</span><br></pre></td></tr></table></figure>

<p><img src="/.com//image-20220115205622409.png" alt="image-20220115205622409"></p>
<p>2）创建 Hbase 表 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hbase(main):001:0&gt; create &#x27;fruit&#x27;,&#x27;info&#x27;</span><br></pre></td></tr></table></figure>

<p>5）使用 scan 命令查看导入后的结果 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):011:0&gt; scan <span class="string">&#x27;fruit&#x27;</span></span><br><span class="line">ROW                                   COLUMN+CELL                                                                                               </span><br><span class="line"> 1001                                 column=info:color, timestamp=1642253156646, value=Red                                                     </span><br><span class="line"> 1001                                 column=info:name, timestamp=1642253156646, value=Apple                                                    </span><br><span class="line"> 1002                                 column=info:color, timestamp=1642253156646, value=Yellow                                                  </span><br><span class="line"> 1002                                 column=info:name, timestamp=1642253156646, value=Pear                                                     </span><br><span class="line"> 1003                                 column=info:color, timestamp=1642253156646, value=Yellow                                                  </span><br><span class="line"> 1003                                 column=info:name, timestamp=1642253156646, value=Pineapple                                                </span><br><span class="line">3 row(s) <span class="keyword">in</span> 0.2760 seconds</span><br></pre></td></tr></table></figure>



<h3 id="4-3-2-自定义-HBase-MapReduce1"><a href="#4-3-2-自定义-HBase-MapReduce1" class="headerlink" title="4.3.2 自定义 HBase-MapReduce1"></a>4.3.2 自定义 HBase-MapReduce1</h3><p>目标：将 fruit 表中的一部分数据，通过 MR 迁入到 fruit_mr 表中。 </p>
<p>分步实现：</p>
<blockquote>
<p>1．构建 ReadFruitMapper 类，用于读取 fruit 表中的数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2022-01-16-时间:8:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitMapper</span> <span class="keyword">extends</span> <span class="title class_">Mapper</span>&lt;LongWritable, Text,LongWritable,Text&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line">        context.write(key,value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>2． 构建 WriteFruitMRReducer 类，用于将读取到的 fruit 表中的数据写入到 fruit_mr 表中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableReducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2022-01-16-时间:8:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitReducer</span> <span class="keyword">extends</span> <span class="title class_">TableReducer</span>&lt;LongWritable, Text, NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以进行动态传参</span></span><br><span class="line">    String cf1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">(Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> context.getConfiguration();</span><br><span class="line"></span><br><span class="line">        cf1 = configuration.get(<span class="string">&quot;cf1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(LongWritable key, Iterable&lt;Text&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.遍历values</span></span><br><span class="line">        <span class="keyword">for</span> (Text value : values) &#123;</span><br><span class="line">            <span class="comment">//获取每一行数据</span></span><br><span class="line">            String[] fields = value.toString().split(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.构建put对象</span></span><br><span class="line">            <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(Bytes.toBytes(fields[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//4.给put对象赋值</span></span><br><span class="line">            put.addColumn(Bytes.toBytes(<span class="string">&quot;info&quot;</span>),Bytes.toBytes(<span class="string">&quot;name&quot;</span>),Bytes.toBytes(fields[<span class="number">1</span>]));</span><br><span class="line">            put.addColumn(Bytes.toBytes(<span class="string">&quot;info&quot;</span>),Bytes.toBytes(<span class="string">&quot;color&quot;</span>),Bytes.toBytes(fields[<span class="number">2</span>]));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//5. 写出</span></span><br><span class="line">            context.write(NullWritable.get(),put);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>3．构建 Fruit2FruitMRRunner extends Configured implements Tool 用于组装运行 Job任务</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableMapReduceUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.Tool;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.ToolRunner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2022-01-16-时间:8:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitDriver</span> <span class="keyword">implements</span> <span class="title class_">Tool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个COnfiguration</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">run</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取Job对象</span></span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 设置驱动类路径</span></span><br><span class="line">        job.setJarByClass(FruitDriver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 设置mapper&amp;mapper输出的KV类型</span></span><br><span class="line">        job.setMapperClass(FruitMapper.class);</span><br><span class="line">        job.setMapOutputKeyClass(LongWritable.class);</span><br><span class="line">        job.setMapOutputValueClass(Text.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 设置Reducer类</span></span><br><span class="line">        TableMapReduceUtil.initTableReducerJob(args[<span class="number">1</span>] , FruitReducer.class , job);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 设置输入输出的参数</span></span><br><span class="line">        FileInputFormat.setInputPaths(job,<span class="keyword">new</span> <span class="title class_">Path</span>(args[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. 提交任务</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConf</span><span class="params">(Configuration configuration)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Configuration <span class="title function_">getConf</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">run</span> <span class="operator">=</span> ToolRunner.run(configuration, <span class="keyword">new</span> <span class="title class_">FruitDriver</span>(), args);</span><br><span class="line"></span><br><span class="line">        System.exit(run);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>4．主函数中调用运行该 Job 任务</p>
</blockquote>
<blockquote>
<p>5．打包运行任务</p>
</blockquote>
<p><img src="/.com//image-20220116120832291.png" alt="image-20220116120832291"></p>
<blockquote>
<ol start="6">
<li>上传jar包到虚拟机，在hbase中创建fruit1表，在运行创建的jar包</li>
</ol>
</blockquote>
<p><img src="/.com//image-20220116100648713.png" alt="image-20220116100648713"></p>
<p>创建fruit表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):003:0* create <span class="string">&#x27;fruit1&#x27;</span>,<span class="string">&#x27;info&#x27;</span></span><br><span class="line">0 row(s) <span class="keyword">in</span> 1.8160 seconds</span><br><span class="line"></span><br><span class="line">=&gt; Hbase::Table - fruit1</span><br></pre></td></tr></table></figure>

<p>运行jar包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop101 ~]$ yarn jar hbase-1.0-SNAPSHOT.jar com.atguigu.mr.FruitDriver input/fruit.tsv fruit1</span><br></pre></td></tr></table></figure>

<p>查看fruit1表中的结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):004:0&gt; scan <span class="string">&#x27;fruit1&#x27;</span></span><br><span class="line">ROW                                   COLUMN+CELL                                                                                               </span><br><span class="line"> 1001                                 column=info:color, timestamp=1642298137576, value=Red                                                     </span><br><span class="line"> 1001                                 column=info:name, timestamp=1642298137576, value=Apple                                                    </span><br><span class="line"> 1002                                 column=info:color, timestamp=1642298137576, value=Yellow                                                  </span><br><span class="line"> 1002                                 column=info:name, timestamp=1642298137576, value=Pear                                                     </span><br><span class="line"> 1003                                 column=info:color, timestamp=1642298137576, value=Yellow                                                  </span><br><span class="line"> 1003                                 column=info:name, timestamp=1642298137576, value=Pineapple                                                </span><br><span class="line">3 row(s) <span class="keyword">in</span> 0.4790 seconds</span><br></pre></td></tr></table></figure>



<h3 id="4-3-3-自定义-Hbase-MapReduce2"><a href="#4-3-3-自定义-Hbase-MapReduce2" class="headerlink" title="4.3.3 自定义 Hbase-MapReduce2"></a>4.3.3 自定义 Hbase-MapReduce2</h3><p>目标：实现将 HDFS 中的数据写入到 Hbase 表中。 </p>
<p>分步实现： </p>
<blockquote>
<p>1．构建 ReadFruitFromHDFSMapper 于读取 HDFS 中的文件数据</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mr2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.Cell;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.CellUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Result;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2022-01-16-时间:10:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fruit2Mapper</span> <span class="keyword">extends</span> <span class="title class_">TableMapper</span>&lt;ImmutableBytesWritable , Put&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">map</span><span class="params">(ImmutableBytesWritable key, Result value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建Put对象</span></span><br><span class="line">        <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(key.get());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取数据</span></span><br><span class="line">        <span class="keyword">for</span> (Cell cell : value.rawCells()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.判断当前的cell是否为”name“列</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;name&quot;</span>.equals(Bytes.toString(CellUtil.cloneQualifier(cell))))&#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//3.给Put对象赋值</span></span><br><span class="line">                put.add(cell);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.写出</span></span><br><span class="line">        context.write(key,put);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>2．构建 WriteFruitMRFromTxtReducer 类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mr2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableReducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.NullWritable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2022-01-16-时间:10:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fruit2Reducer</span> <span class="keyword">extends</span> <span class="title class_">TableReducer</span>&lt;ImmutableBytesWritable , Put , NullWritable&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">reduce</span><span class="params">(ImmutableBytesWritable key, Iterable&lt;Put&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1。遍历写出</span></span><br><span class="line">        <span class="keyword">for</span> (Put value : values) &#123;</span><br><span class="line"></span><br><span class="line">            context.write(NullWritable.get(),value);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>3．创建 Txt2FruitRunner 组装 Job</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.mr2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.HBaseConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Put;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.client.Scan;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.io.ImmutableBytesWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.TableMapReduceUtil;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.Tool;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.ToolRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2022-01-16-时间:10:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Fruit2Driver</span> <span class="keyword">implements</span> <span class="title class_">Tool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义配置信息</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">run</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.获取Job对象</span></span><br><span class="line">        <span class="type">Job</span> <span class="variable">job</span> <span class="operator">=</span> Job.getInstance(configuration);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 设置主类路径</span></span><br><span class="line">        job.setJarByClass(Fruit2Driver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.设置Mapper&amp;输出KV类型</span></span><br><span class="line">        TableMapReduceUtil.initTableMapperJob(</span><br><span class="line">                <span class="string">&quot;fruit&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Scan</span>(),</span><br><span class="line">                Fruit2Mapper.class,</span><br><span class="line">                ImmutableBytesWritable.class,</span><br><span class="line">                Put.class,</span><br><span class="line">                job</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.设置Reducer&amp;输出的表</span></span><br><span class="line">        TableMapReduceUtil.initTableReducerJob(</span><br><span class="line">                <span class="string">&quot;fruit12&quot;</span>,</span><br><span class="line">                Fruit2Reducer.class,</span><br><span class="line">                job</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.提交任务</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConf</span><span class="params">(Configuration configuration)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Configuration <span class="title function_">getConf</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">configuration</span> <span class="operator">=</span> HBaseConfiguration.create();</span><br><span class="line"></span><br><span class="line">        ToolRunner.run(configuration, <span class="keyword">new</span> <span class="title class_">Fruit2Driver</span>() , args);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="4-4-与-Hive-的集成"><a href="#4-4-与-Hive-的集成" class="headerlink" title="4.4 与 Hive 的集成"></a>4.4 与 Hive 的集成</h2><h3 id="4-4-1-HBase-与-Hive-的对比"><a href="#4-4-1-HBase-与-Hive-的对比" class="headerlink" title="4.4.1 HBase 与 Hive 的对比"></a>4.4.1 HBase 与 Hive 的对比</h3><blockquote>
<p>1．Hive</p>
</blockquote>
<p> (1) 数据仓库 Hive 的本质其实就相当于将 HDFS 中已经存储的文件在 Mysql 中做了一个双射关系，以 方便使用 HQL 去管理查询。</p>
<p> (2) 用于数据分析、清洗 Hive 适用于离线的数据分析和清洗，延迟较高。</p>
<p> (3) 基于 HDFS、MapReduce Hive 存储的数据依旧在 DataNode 上，编写的 HQL 语句终将是转换为 MapReduce 代码执 行。 </p>
<blockquote>
<p>2．HBase</p>
</blockquote>
<p> (1) 数据库 是一种面向列族存储的非关系型数据库。</p>
<p> (2) 用于存储结构化和非结构化的数据 适用于单表非关系型数据的存储，不适合做关联查询，类似 JOIN 等操作。</p>
<p> (3) 基于 HDFS 数据持久化存储的体现形式是 HFile，存放于 DataNode 中，被 ResionServer 以 region 的形 式进行管理。</p>
<p> (4) 延迟较低，接入在线业务使用 面对大量的企业数据，HBase 可以直线单表大量数据的存储，同时提供了高效的数据访问 速度。</p>
<h3 id="4-4-2-HBase-与-Hive-集成使用"><a href="#4-4-2-HBase-与-Hive-集成使用" class="headerlink" title="4.4.2 HBase 与 Hive 集成使用"></a>4.4.2 HBase 与 Hive 集成使用</h3><p>尖叫提示：HBase 与 Hive 的集成在最新的两个版本中无法兼容。所以，我们只能含着泪勇 敢的重新编译：hive-hbase-handler-1.2.2.jar！！好气！！</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.quorum<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop100,hadoop101,hadoop102<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>The list of ZooKeeper servers to talk to. This is only needed for read/write locks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.zookeeper.client.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>2181<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>The port of ZooKeeper servers to talk to. This is only needed for read/write locks.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置好后分发到其他服务器上</p>
<blockquote>
<p>1．案例一 目标：建立 Hive 表，关联 HBase 表，插入数据到 Hive 表的同时能够影响 HBase 表。</p>
</blockquote>
<p> 分步实现： </p>
<p>(1) 在 Hive 中创建表同时关联 HBase</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> hive_hbase_emp_table(</span><br><span class="line">empno <span class="type">int</span>,</span><br><span class="line">ename string,</span><br><span class="line">job string,</span><br><span class="line">mgr <span class="type">int</span>,</span><br><span class="line">hiredate string,</span><br><span class="line">sal <span class="keyword">double</span>,</span><br><span class="line">comm <span class="keyword">double</span>,</span><br><span class="line">deptno <span class="type">int</span>)</span><br><span class="line">STORED <span class="keyword">BY</span> <span class="string">&#x27;org.apache.hadoop.hive.hbase.HBaseStorageHandler&#x27;</span></span><br><span class="line"><span class="keyword">WITH</span> SERDEPROPERTIES (&quot;hbase.columns.mapping&quot; <span class="operator">=</span> </span><br><span class="line">&quot;:key,info:ename,info:job,info:mgr,info:hiredate,info:sal,info:comm,info:deptno&quot;)</span><br><span class="line">TBLPROPERTIES (&quot;hbase.table.name&quot; <span class="operator">=</span> &quot;hbase_emp_table&quot;);</span><br></pre></td></tr></table></figure>

<p>提示：完成之后，可以分别进入 Hive 和 HBase 查看，都生成了对应的表 </p>
<blockquote>
<p>(2) 在 Hive 中创建临时中间表，用于 load 文件中的数据 </p>
</blockquote>
<p>提示：不能将数据直接 load 进 Hive 所关联 HBase 的那张表中</p>
<h1 id="第-5-章-HBase-优化"><a href="#第-5-章-HBase-优化" class="headerlink" title="第 5 章 HBase 优化"></a>第 5 章 HBase 优化</h1><h2 id="5-1-高可用"><a href="#5-1-高可用" class="headerlink" title="5.1 高可用"></a>5.1 高可用</h2><p>在 HBase 中 HMaster 负责监控 HRegionServer 的生命周期，均衡 RegionServer 的负载， 如果 HMaster 挂掉了，那么整个 HBase 集群将陷入不健康的状态，并且此时的工作状态并不会维持太久。所以 HBase 支持对 HMaster 的高可用配置。 </p>
<blockquote>
<p>1．关闭 HBase 集群（如果没有开启则跳过此步）</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 hbase]$ bin/stop-hbase.sh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2．在 conf 目录下创建 backup-masters 文件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 hbase]$ <span class="built_in">touch</span> conf/backup-masters</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3．在 backup-masters 文件中配置高可用 HMaster 节点</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 hbase]$ <span class="built_in">echo</span> hadoop103 &gt; conf/backup-masters</span><br></pre></td></tr></table></figure>

<blockquote>
<p>4．将整个 conf 目录 scp 到其他节点</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 hbase]$ scp -r conf/ </span><br><span class="line">hadoop103:/opt/module/hbase/</span><br><span class="line">[atguigu@hadoop102 hbase]$ scp -r conf/ </span><br><span class="line">hadoop104:/opt/module/hbase/</span><br></pre></td></tr></table></figure>

<blockquote>
<p>5．打开页面测试查看 <a target="_blank" rel="noopener" href="http://hadooo102:16010/">http://hadooo102:16010</a></p>
</blockquote>
<h2 id="5-2-预分区"><a href="#5-2-预分区" class="headerlink" title="5.2 预分区"></a>5.2 预分区</h2><p>每一个 region 维护着 StartRow 与 EndRow，如果加入的数据符合某个 Region 维护的 RowKey 范围，则该数据交给这个 Region 维护。那么依照这个原则，我们可以将数据所要投放的分区提前大致的规划好，以提高 HBase 性能。</p>
<p>1．手动设定预分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hbase&gt; create <span class="string">&#x27;staff1&#x27;</span>,<span class="string">&#x27;info&#x27;</span>,<span class="string">&#x27;partition1&#x27;</span>,SPLITS =&gt;  [<span class="string">&#x27;1000&#x27;</span>,<span class="string">&#x27;2000&#x27;</span>,<span class="string">&#x27;3000&#x27;</span>,<span class="string">&#x27;4000&#x27;</span>] </span><br></pre></td></tr></table></figure>

<p>2．生成 16 进制序列预分区 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">&#x27;staff2&#x27;</span>,<span class="string">&#x27;info&#x27;</span>,<span class="string">&#x27;partition2&#x27;</span>,&#123;NUMREGIONS =&gt; 15, SPLITALGO =&gt;  <span class="string">&#x27;HexStringSplit&#x27;</span>&#125; </span><br></pre></td></tr></table></figure>

<p>3．按照文件中设置的规则预分区 创建 splits.txt 文件内容如下： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aaaa bbbb cccc dddd </span><br></pre></td></tr></table></figure>

<p>然后执行： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">&#x27;staff3&#x27;</span>,<span class="string">&#x27;partition3&#x27;</span>,SPLITS_FILE =&gt; <span class="string">&#x27;splits.txt&#x27;</span> </span><br></pre></td></tr></table></figure>

<p>4．使用 JavaAPI 创建预分区 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义算法，产生一系列 hash 散列值存储在二维数组中</span></span><br><span class="line"><span class="type">byte</span>[][] splitKeys = 某个散列值函数</span><br><span class="line"><span class="comment">//创建 HbaseAdmin 实例</span></span><br><span class="line"><span class="type">HBaseAdmin</span> <span class="variable">hAdmin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HBaseAdmin</span>(HbaseConfiguration.create());</span><br><span class="line"><span class="comment">//创建 HTableDescriptor 实例</span></span><br><span class="line"><span class="type">HTableDescriptor</span> <span class="variable">tableDesc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HTableDescriptor</span>(tableName);</span><br><span class="line"><span class="comment">//通过 HTableDescriptor 实例和散列值二维数组创建带有预分区的 Hbase 表</span></span><br><span class="line">hAdmin.createTable(tableDesc, splitKeys);</span><br></pre></td></tr></table></figure>



<h2 id="5-3-RowKey"><a href="#5-3-RowKey" class="headerlink" title="5.3 RowKey"></a>5.3 RowKey</h2><p>设计 一条数据的唯一标识就是 RowKey，那么这条数据存储于哪个分区，取决于 RowKey 处于哪个一个预分区的区间内，设计 RowKey 的主要目的 ，就是让数据均匀的分布于所有的 region 中，在一定程度上防止数据倾斜。接下来我们就谈一谈 RowKey 常用的设计方案。</p>
<blockquote>
<p>1．生成随机数、hash、散列值</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">比如：</span><br><span class="line">原 本 rowKey 为 1001 的 ， SHA1 后 变 成 ：</span><br><span class="line">dd01903921ea24941c26a48f2cec24e0bb0e8cc7</span><br><span class="line">原 本 rowKey 为 3001 的 ， SHA1 后 变 成 ：</span><br><span class="line">49042c54de64a1e9bf0b33e00245660ef92dc7bd</span><br><span class="line">原 本 rowKey 为 5001 的 ， SHA1 后 变 成 ：</span><br><span class="line">7b61dec07e02c188790670af43e717f0f46e8913</span><br><span class="line">在做此操作之前，一般我们会选择从数据集中抽取样本，来决定什么样的 rowKey 来 Hash</span><br><span class="line">后作为每个分区的临界值。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>2．字符串反转</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">20170524000001 转成 10000042507102</span><br><span class="line">20170524000002 转成 20000042507102</span><br></pre></td></tr></table></figure>

<p>这样也可以在一定程度上散列逐步 put 进来的数据。 </p>
<blockquote>
<p>3．字符串拼接</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">20170524000001_a12e</span><br><span class="line">20170524000001_93i7</span><br></pre></td></tr></table></figure>

<h2 id="5-4-内存优化"><a href="#5-4-内存优化" class="headerlink" title="5.4 内存优化"></a>5.4 内存优化</h2><p>HBase 操作过程中需要大量的内存开销，毕竟 Table 是可以缓存在内存中的，<strong>一般会分配整个可用内存的 70%给 HBase 的 Java 堆</strong>。但是不建议分配非常大的堆内存，因为 GC 过 程持续太久会导致 RegionServer 处于长期不可用状态，一般 16~48G 内存就可以了，如果因为框架占用内存过高导致系统内存不足，框架一样会被系统服务拖死。</p>
<h2 id="5-5-基础优化"><a href="#5-5-基础优化" class="headerlink" title="5.5 基础优化"></a>5.5 基础优化</h2><p>1．允许在 HDFS 的文件中追加内容 </p>
<p>hdfs-site.xml、hbase-site.xml </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.support.append </span><br><span class="line">解释：开启 HDFS 追加同步，可以优秀的配合 HBase 的数据同步和持久化。默认值为 true。 </span><br></pre></td></tr></table></figure>

<p>2．优化 DataNode 允许的最大文件打开数 </p>
<p>hdfs-site.xml </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.datanode.max.transfer.threads </span><br><span class="line">解释：HBase 一般都会同一时间操作大量的文件，根据集群的数量和规模以及数据动作， 设置为 4096 或者更高。默认值：4096</span><br></pre></td></tr></table></figure>

<p> 3．优化延迟高的数据操作的等待时间 </p>
<p>hdfs-site.xml </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">属性：dfs.image.transfer.timeout </span><br><span class="line">解释：如果对于某一次数据操作来讲，延迟非常高，socket 需要等待更长的时间，建议把 该值设置为更大的值（默认 60000 毫秒），以确保 socket 不会被 timeout 掉。</span><br></pre></td></tr></table></figure>

<p> 4．优化数据的写入效率 </p>
<p>mapred-site.xml </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">属性：</span><br><span class="line">mapreduce.map.output.compress </span><br><span class="line">mapreduce.map.output.compress.codec </span><br><span class="line">解释：开启这两个数据可以大大提高文件的写入效率，减少写入时间。第一个属性值修改为 true，第二个属性值修改为：org.apache.hadoop.io.compress.GzipCodec 或者其 他压缩方式。</span><br></pre></td></tr></table></figure>

<p> 5．设置 RPC 监听数量 </p>
<p>hbase-site.xml </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">属性：Hbase.regionserver.handler.count </span><br><span class="line">解释：默认值为 30，用于指定 RPC 监听的数量，可以根据客户端的请求数进行调整，读写 请求较多时，增加此值。</span><br></pre></td></tr></table></figure>

<p> 6．优化 HStore 文件大小 </p>
<p>hbase-site.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">属性：hbase.hregion.max.filesize </span><br><span class="line">解释：默认值 10737418240（10GB），如果需要运行 HBase 的 MR 任务，可以减小此值， 因为一个 region 对应一个 map 任务，如果单个 region 过大，会导致 map 任务执行时间 过长。该值的意思就是，如果 HFile 的大小达到这个数值，则这个 region 会被切分为两 个 Hfile。</span><br></pre></td></tr></table></figure>

<p> 7．优化 HBase 客户端缓存 </p>
<p>hbase-site.xml </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">属性：hbase.client.write.buffer </span><br><span class="line">解释：用于指定 Hbase 客户端缓存，增大该值可以减少 RPC 调用次数，但是会消耗更多内 存，反之则反之。一般我们需要设定一定的缓存大小，以达到减少 RPC 次数的目的。</span><br></pre></td></tr></table></figure>

<p> 8．指定 scan.next 扫描 HBase 所获取的行数 </p>
<p>hbase-site.xml </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">属性：hbase.client.scanner.caching </span><br><span class="line">解释：用于指定 scan.next 方法获取的默认行数，值越大，消耗内存越大。 </span><br></pre></td></tr></table></figure>

<p>9．flush、compact、split 机制 当 MemStore 达到阈值，将 Memstore 中的数据 Flush 进 Storefile；compact 机制则是把 flush 出来的小文件合并成大的 Storefile 文件。split 则是当 Region 达到阈值，会把过大的 Region 一分为二。 </p>
<p>涉及属性： 即：128M 就是 Memstore 的默认阈值 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase.hregion.memstore.flush.size：134217728</span><br></pre></td></tr></table></figure>

<p> 即：这个参数的作用是当单个 HRegion 内所有的 Memstore 大小总和超过指定值时，flush 该 HRegion 的所有 memstore。RegionServer 的 flush 是通过将请求添加一个队列，模拟生 产消费模型来异步处理的。那这里就有一个问题，当队列来不及消费，产生大量积压请求 时，可能会导致内存陡增，最坏的情况是触发 OOM。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hbase.regionserver.global.memstore.upperLimit：0.4 </span><br><span class="line">hbase.regionserver.global.memstore.lowerLimit：0.38</span><br></pre></td></tr></table></figure>

<p> 即：当 MemStore 使用内存总量达到hbase.regionserver.global.memstore.upperLimit 指定值时，将会有多个 MemStores flush 到文件中，MemStore flush 顺序是按照大小降序执行的，直到 刷新到 MemStore 使用内存略小于 lowerLimit</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">DingQuan Zuo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/06/26/%E5%A4%A7%E6%95%B0%E6%8D%AE%E2%80%94%E2%80%94Hbase/">http://example.com/2023/06/26/%E5%A4%A7%E6%95%B0%E6%8D%AE%E2%80%94%E2%80%94Hbase/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">ccbigs blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a></div><div class="post_share"><div class="social-share" data-image="/img/ahead.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/06/26/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="hexo的next主题使用方法"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">hexo的next主题使用方法</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/ahead.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">DingQuan Zuo</div><div class="author-info__description">技术路上少不了自我怀疑，往往你的决定，会让你看到不同的风景</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ccbigs" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1692062014@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HBase"><span class="toc-number">1.</span> <span class="toc-text">HBase</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0HBase%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">第1章HBase简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1HBase%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.</span> <span class="toc-text">1.1HBase定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2HBase%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">1.2HBase数据模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1HBase%E9%80%BB%E8%BE%91%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.2.1HBase逻辑结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2HBase%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.2.</span> <span class="toc-text">1.2.2HBase物理存储结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.2.3.</span> <span class="toc-text">1.2.3数据模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3HBase%E5%9F%BA%E6%9C%AC%E6%9E%B6%E6%9E%84"><span class="toc-number">2.3.</span> <span class="toc-text">1.3HBase基本架构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0HBase%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">3.</span> <span class="toc-text">第2章HBase快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1HBase%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">3.1.</span> <span class="toc-text">2.1HBase安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1Zookeeper%E6%AD%A3%E5%B8%B8%E9%83%A8%E7%BD%B2"><span class="toc-number">3.1.1.</span> <span class="toc-text">2.1.1Zookeeper正常部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2Hadoop%E6%AD%A3%E5%B8%B8%E9%83%A8%E7%BD%B2"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.1.2Hadoop正常部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3HBase%E7%9A%84%E8%A7%A3%E5%8E%8B"><span class="toc-number">3.1.3.</span> <span class="toc-text">2.1.3HBase的解压</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4HBase%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.1.4.</span> <span class="toc-text">2.1.4HBase的配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5HBase%E8%BF%9C%E7%A8%8B%E5%8F%91%E9%80%81%E5%88%B0%E5%85%B6%E4%BB%96%E9%9B%86%E7%BE%A4"><span class="toc-number">3.1.5.</span> <span class="toc-text">2.1.5HBase远程发送到其他集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-6HBase%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="toc-number">3.1.6.</span> <span class="toc-text">2.1.6HBase服务的启动</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2HBaseShell%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.</span> <span class="toc-text">2.2HBaseShell操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.1.</span> <span class="toc-text">2.2.1基本操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.2.</span> <span class="toc-text">2.2.2表的操作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0HBase%E8%BF%9B%E9%98%B6"><span class="toc-number">4.</span> <span class="toc-text">第3章HBase进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E6%9E%B6%E6%9E%84%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">3.1架构原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%E5%86%99%E6%B5%81%E7%A8%8B"><span class="toc-number">4.2.</span> <span class="toc-text">3.2写流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-MemStoreFlush"><span class="toc-number">4.3.</span> <span class="toc-text">3.3 MemStoreFlush</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E8%AF%BB%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.</span> <span class="toc-text">3.4 读流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-StoreFile-Compaction"><span class="toc-number">4.5.</span> <span class="toc-text">3.5 StoreFile Compaction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-Region-Split"><span class="toc-number">4.6.</span> <span class="toc-text">3.6 Region Split</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC-4-%E7%AB%A0-HBase-API"><span class="toc-number">5.</span> <span class="toc-text">第 4 章 HBase API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-HBaseAPI"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 HBaseAPI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E8%8E%B7%E5%8F%96-Configuration-%E5%AF%B9%E8%B1%A1"><span class="toc-number">5.2.1.</span> <span class="toc-text">4.2.1 获取 Configuration 对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E5%88%A4%E6%96%AD%E8%A1%A8%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8"><span class="toc-number">5.2.2.</span> <span class="toc-text">4.2.2 判断表是否存在</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-DDL"><span class="toc-number">5.2.3.</span> <span class="toc-text">4.2.3 DDL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-DDL"><span class="toc-number">5.2.4.</span> <span class="toc-text">4.2.4 DDL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-MapReduce"><span class="toc-number">5.3.</span> <span class="toc-text">4.3 MapReduce</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-%E5%AE%98%E6%96%B9-HBase-MapReduce"><span class="toc-number">5.3.1.</span> <span class="toc-text">4.3.1 官方 HBase-MapReduce</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-%E8%87%AA%E5%AE%9A%E4%B9%89-HBase-MapReduce1"><span class="toc-number">5.3.2.</span> <span class="toc-text">4.3.2 自定义 HBase-MapReduce1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-3-%E8%87%AA%E5%AE%9A%E4%B9%89-Hbase-MapReduce2"><span class="toc-number">5.3.3.</span> <span class="toc-text">4.3.3 自定义 Hbase-MapReduce2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E4%B8%8E-Hive-%E7%9A%84%E9%9B%86%E6%88%90"><span class="toc-number">5.4.</span> <span class="toc-text">4.4 与 Hive 的集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-HBase-%E4%B8%8E-Hive-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">5.4.1.</span> <span class="toc-text">4.4.1 HBase 与 Hive 的对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2-HBase-%E4%B8%8E-Hive-%E9%9B%86%E6%88%90%E4%BD%BF%E7%94%A8"><span class="toc-number">5.4.2.</span> <span class="toc-text">4.4.2 HBase 与 Hive 集成使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC-5-%E7%AB%A0-HBase-%E4%BC%98%E5%8C%96"><span class="toc-number">6.</span> <span class="toc-text">第 5 章 HBase 优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="toc-number">6.1.</span> <span class="toc-text">5.1 高可用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E9%A2%84%E5%88%86%E5%8C%BA"><span class="toc-number">6.2.</span> <span class="toc-text">5.2 预分区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-RowKey"><span class="toc-number">6.3.</span> <span class="toc-text">5.3 RowKey</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96"><span class="toc-number">6.4.</span> <span class="toc-text">5.4 内存优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-%E5%9F%BA%E7%A1%80%E4%BC%98%E5%8C%96"><span class="toc-number">6.5.</span> <span class="toc-text">5.5 基础优化</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/26/%E5%A4%A7%E6%95%B0%E6%8D%AE%E2%80%94%E2%80%94Hbase/" title="大数据——Hbase">大数据——Hbase</a><time datetime="2023-06-26T08:53:45.000Z" title="发表于 2023-06-26 16:53:45">2023-06-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/26/hexo%E7%9A%84next%E4%B8%BB%E9%A2%98%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="hexo的next主题使用方法">hexo的next主题使用方法</a><time datetime="2023-06-26T08:35:14.000Z" title="发表于 2023-06-26 16:35:14">2023-06-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/06/26/hexo%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/" title="hexo的安装与使用">hexo的安装与使用</a><time datetime="2023-06-26T06:39:17.000Z" title="发表于 2023-06-26 14:39:17">2023-06-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By DingQuan Zuo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>