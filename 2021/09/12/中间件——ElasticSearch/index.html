<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>中间件——ElasticSearch | ccbigs blog</title><meta name="author" content="DingQuan Zuo"><meta name="copyright" content="DingQuan Zuo"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ElasticSearch 1.ElasticSearch概述1.1 Elasticsearch 是什么 The Elastic Stack, 包括 Elasticsearch、Kibana、Beats 和 Logstash（也称为 ELK Stack）。 能够安全可靠地获取任何来源、任何格式的数据，然后实时地对数据进行搜索、分析和可视 化。Elaticsearch，简称为 ES，ES &amp;#x3D">
<meta property="og:type" content="article">
<meta property="og:title" content="中间件——ElasticSearch">
<meta property="og:url" content="http://example.com/2021/09/12/%E4%B8%AD%E9%97%B4%E4%BB%B6%E2%80%94%E2%80%94ElasticSearch/index.html">
<meta property="og:site_name" content="ccbigs blog">
<meta property="og:description" content="ElasticSearch 1.ElasticSearch概述1.1 Elasticsearch 是什么 The Elastic Stack, 包括 Elasticsearch、Kibana、Beats 和 Logstash（也称为 ELK Stack）。 能够安全可靠地获取任何来源、任何格式的数据，然后实时地对数据进行搜索、分析和可视 化。Elaticsearch，简称为 ES，ES &amp;#x3D">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/ahead.jpg">
<meta property="article:published_time" content="2021-09-12T14:01:28.000Z">
<meta property="article:modified_time" content="2024-10-22T12:05:03.336Z">
<meta property="article:author" content="DingQuan Zuo">
<meta property="article:tag" content="中间件">
<meta property="article:tag" content="ElasticSearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/ahead.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/09/12/%E4%B8%AD%E9%97%B4%E4%BB%B6%E2%80%94%E2%80%94ElasticSearch/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '中间件——ElasticSearch',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-22 20:05:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/ahead.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/1558.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ccbigs blog"><img class="site-icon" src="/img/favicon.png"/><span class="site-name">ccbigs blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">中间件——ElasticSearch</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-12T14:01:28.000Z" title="发表于 2021-09-12 22:01:28">2021-09-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-22T12:05:03.336Z" title="更新于 2024-10-22 20:05:03">2024-10-22</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">21.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>86分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="中间件——ElasticSearch"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h1><p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210826200620436.png" alt="image-20210826200620436"></p>
<h1 id="1-ElasticSearch概述"><a href="#1-ElasticSearch概述" class="headerlink" title="1.ElasticSearch概述"></a>1.ElasticSearch概述</h1><h2 id="1-1-Elasticsearch-是什么"><a href="#1-1-Elasticsearch-是什么" class="headerlink" title="1.1 Elasticsearch 是什么"></a>1.1 Elasticsearch 是什么</h2><p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210826200957408.png" alt="image-20210826200957408"></p>
<p>The Elastic Stack, 包括 Elasticsearch、Kibana、Beats 和 Logstash（也称为 ELK Stack）。 能够安全可靠地获取任何来源、任何格式的数据，然后实时地对数据进行搜索、分析和可视 化。Elaticsearch，简称为 ES，ES &#x3D;&#x3D;是一个开源的高扩展的分布式全文搜索引擎&#x3D;&#x3D;，是整个 Elastic  Stack 技术栈的核心。它可以近乎实时的存储、检索数据；本身扩展性很好，可以扩展到上 百台服务器，处理 PB 级别的数据。</p>
<h2 id="1-2-全文搜索引擎"><a href="#1-2-全文搜索引擎" class="headerlink" title="1.2 全文搜索引擎"></a>1.2 全文搜索引擎</h2><p>Google，百度类的网站搜索，它们都是根据网页中的关键字生成索引，我们在搜索的时 候输入关键字，它们会将该关键字即索引匹配到的所有网页返回；还有常见的项目中应用日 志的搜索等等。对于这些非结构化的数据文本，关系型数据库搜索不是能很好的支持。 </p>
<p>一般传统数据库，全文检索都实现的很鸡肋，因为一般也没人用数据库存文本字段。进 行全文检索需要扫描整个表，如果数据量大的话即使对 SQL 的语法优化，也收效甚微。建 立了索引，但是维护起来也很麻烦，对于 insert 和 update 操作都会重新构建索引。 </p>
<p>基于以上原因可以分析得出，在一些生产环境中，使用常规的搜索方式，性能是非常差 的： </p>
<p> 搜索的数据对象是大量的非结构化的文本数据。 </p>
<p> 文件记录量达到数十万或数百万个甚至更多。</p>
<p> 支持大量基于交互式文本的查询。 </p>
<p> 需求非常灵活的全文搜索查询。 </p>
<p> 对高度相关的搜索结果的有特殊需求，但是没有可用的关系数据库可以满足。</p>
<p> 对不同记录类型、非文本数据操作或安全事务处理的需求相对较少的情况。 为了解决结构化数据搜索和非结构化数据搜索性能问题，我们就需要专业，健壮，强大的全 文搜索引擎。</p>
<p>这里说到的全文搜索引擎指的是目前广泛应用的主流搜索引擎。它的工作原理是计算机 索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的 次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反 馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。</p>
<h2 id="1-3-Elasticsearch-And-Solr"><a href="#1-3-Elasticsearch-And-Solr" class="headerlink" title="1.3 Elasticsearch And Solr"></a>1.3 Elasticsearch And Solr</h2><p>Lucene 是 Apache 软件基金会 Jakarta 项目组的一个子项目，提供了一个简单却强大的 应用程式接口，能够做全文索引和搜寻。在 Java 开发环境里 Lucene 是一个成熟的免费开源 工具。就其本身而言，Lucene 是当前以及最近几年最受欢迎的免费 Java 信息检索程序库。 但 Lucene 只是一个提供全文搜索功能类库的核心工具包，而真正使用它还需要一个完善的 服务框架搭建起来进行应用。 </p>
<p>目前市面上流行的搜索引擎软件，主流的就两款：Elasticsearch 和 Solr,这两款都是基 于 Lucene 搭建的，可以独立部署启动的搜索引擎服务软件。由于内核相同，所以两者除了 服务器安装、部署、管理、集群以外，对于数据的操作 修改、添加、保存、查询等等都十 分类似。 </p>
<p>在使用过程中，一般都会将 Elasticsearch 和 Solr 这两个软件对比，然后进行选型。这两 个搜索引擎都是流行的，先进的的开源搜索引擎。它们都是围绕核心底层搜索库 - Lucene 构建的 - 但它们又是不同的。像所有东西一样，每个都有其优点和缺点：</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210826201607278.png" alt="image-20210826201607278"></p>
<h2 id="1-4-Elasticsearch-Or-Solr"><a href="#1-4-Elasticsearch-Or-Solr" class="headerlink" title="1.4 Elasticsearch Or Solr"></a>1.4 Elasticsearch Or Solr</h2><p>Elasticsearch 和 Solr 都是开源搜索引擎，那么我们在使用时该如何选择呢？ </p>
<p> Google 搜索趋势结果表明，与 Solr 相比，Elasticsearch 具有很大的吸引力，但这并不 意味着 Apache Solr 已经死亡。虽然有些人可能不这么认为，但 Solr 仍然是最受欢迎的 搜索引擎之一，拥有强大的社区和开源支持。 </p>
<p> 与 Solr 相比，Elasticsearch 易于安装且非常轻巧。此外，你可以在几分钟内安装并运行 Elasticsearch。但是，如果 Elasticsearch 管理不当，这种易于部署和使用可能会成为一个 问题。基于 JSON 的配置很简单，但如果要为文件中的每个配置指定注释，那么它不适 合您。总的来说，如果你的应用使用的是 JSON，那么 Elasticsearch 是一个更好的选择。 否则，请使用 Solr，因为它的 schema.xml 和 solrconfig.xml 都有很好的文档记录。 </p>
<p> Solr 拥有更大，更成熟的用户，开发者和贡献者社区。ES 虽拥有的规模较小但活跃的 用户社区以及不断增长的贡献者社区。 Solr 贡献者和提交者来自许多不同的组织，而 Elasticsearch 提交者来自单个公司。 </p>
<p> Solr 更成熟，但 ES 增长迅速，更稳定。 </p>
<p> Solr 是一个非常有据可查的产品，具有清晰的示例和 API 用例场景。 Elasticsearch 的 文档组织良好，但它缺乏好的示例和清晰的配置说明。 那么，到底是 Solr 还是 Elasticsearch？ 有时很难找到明确的答案。无论您选择 Solr 还是 Elasticsearch，首先需要了解正确的用 例和未来需求。总结他们的每个属性。 </p>
<p> 由于易于使用，Elasticsearch 在新开发者中更受欢迎。一个下载和一个命令就可以启动 一切。 </p>
<p> 如果除了搜索文本之外还需要它来处理分析查询，Elasticsearch 是更好的选择 </p>
<p> 如果需要分布式索引，则需要选择 Elasticsearch。对于需要良好可伸缩性和以及性能分 布式环境，Elasticsearch 是更好的选择。 </p>
<p> Elasticsearch 在开源日志管理用例中占据主导地位，许多组织在 Elasticsearch 中索引它 们的日志以使其可搜索。 </p>
<p> 如果你喜欢监控和指标，那么请使用 Elasticsearch，因为相对于 Solr，Elasticsearch 暴露 了更多的关键指标</p>
<h2 id="1-5-Elasticsearch-应用案例"><a href="#1-5-Elasticsearch-应用案例" class="headerlink" title="1.5 Elasticsearch 应用案例"></a>1.5 Elasticsearch 应用案例</h2><p> GitHub: 2013 年初，抛弃了 Solr，采取 Elasticsearch 来做 PB 级的搜索。“GitHub 使用 Elasticsearch 搜索 20TB 的数据，包括 13 亿文件和 1300 亿行代码”。 </p>
<p> 维基百科：启动以 Elasticsearch 为基础的核心搜索架构 </p>
<p> SoundCloud：“SoundCloud 使用 Elasticsearch 为 1.8 亿用户提供即时而精准的音乐搜索 服务”。 </p>
<p> 百度：目前广泛使用 Elasticsearch 作为文本数据分析，采集百度所有服务器上的各类指 标数据及用户自定义数据，通过对各种数据进行多维分析展示，辅助定位分析实例异常 或业务层面异常。目前覆盖百度内部 20 多个业务线（包括云分析、网盟、预测、文库、 直达号、钱包、风控等），单集群最大 100 台机器，200 个 ES 节点，每天导入 30TB+ 数据。 </p>
<p> 新浪：使用 Elasticsearch 分析处理 32 亿条实时日志。 </p>
<p> 阿里：使用 Elasticsearch 构建日志采集和分析体系。 </p>
<p> Stack Overflow：解决 Bug 问题的网站，全英文，编程人员交流的网站。</p>
<h1 id="2-ElasticSearch使用"><a href="#2-ElasticSearch使用" class="headerlink" title="2.ElasticSearch使用"></a>2.ElasticSearch使用</h1><h2 id="2-1-数据格式"><a href="#2-1-数据格式" class="headerlink" title="2.1 数据格式"></a>2.1 数据格式</h2><p>Elasticsearch 是面向文档型数据库，一条数据在这里就是一个文档。为了方便大家理解， 我们将 Elasticsearch 里存储文档数据和关系型数据库 MySQL 存储数据的概念进行一个类比。</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827152508739.png" alt="image-20210827152508739"></p>
<p>ES 里的 Index 可以看做一个库，而 Types 相当于表，Documents 则相当于表的行。 这里 Types 的概念已经被逐渐弱化，Elasticsearch 6.X 中，一个 index 下已经只能包含一个 type，&#x3D;&#x3D;Elasticsearch 7.X 中, Type 的概念已经被删除了&#x3D;&#x3D;。</p>
<h2 id="2-2-索引"><a href="#2-2-索引" class="headerlink" title="2.2 索引"></a>2.2 索引</h2><h3 id="2-2-1-索引创建"><a href="#2-2-1-索引创建" class="headerlink" title="2.2.1 索引创建"></a>2.2.1 索引创建</h3><p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827153402825.png" alt="image-20210827153402825"></p>
<p>&#x3D;&#x3D;因为原来已经创建了，所以put请求的幂等性会直接返回错误&#x3D;&#x3D;</p>
<h3 id="2-2-2-查询索引-amp-删除索引"><a href="#2-2-2-查询索引-amp-删除索引" class="headerlink" title="2.2.2 查询索引&amp;删除索引"></a>2.2.2 查询索引&amp;删除索引</h3><p><strong>查询</strong></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827153604610.png" alt="image-20210827153604610"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;shopping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;aliases&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;mappings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;creation_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1629988091027&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;number_of_shards&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7bPtOHYQQbOHlcTEypMzig&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7080099&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;provided_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;shopping&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong>查看所有的索引</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost:9200/_cat/indices?v">http://localhost:9200/_cat/indices?v</a></p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827153732454.png" alt="image-20210827153732454"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">health status index    uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span><br><span class="line">yellow open   shopping <span class="number">7</span>bPtOHYQQbOHlcTEypMzig   <span class="number">1</span>   <span class="number">1</span>          <span class="number">0</span>            <span class="number">0</span>       <span class="number">208</span>b           <span class="number">208</span>b</span><br></pre></td></tr></table></figure>



<p><strong>删除</strong></p>
<blockquote>
<p>使用delete请求</p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827153941036.png" alt="image-20210827153941036"></p>
<h2 id="2-3-文档操作"><a href="#2-3-文档操作" class="headerlink" title="2.3 文档操作"></a>2.3 文档操作</h2><h3 id="2-3-1-文档创建"><a href="#2-3-1-文档创建" class="headerlink" title="2.3.1 文档创建"></a>2.3.1 文档创建</h3><p>索引已经创建好了，接下来我们来创建文档，并添加数据。这里的文档可以类比为关系型数 据库中的表数据，添加的数据格式为 JSON 格式 在 Postman 中，向 ES 服务器发 POST 请求 ：<a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_doc">http://127.0.0.1:9200/shopping/_doc</a></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827154357528.png" alt="image-20210827154357528"></p>
<p>我们来添加请求体：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;小米手机&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;小米&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">3999.00</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827154445233.png" alt="image-20210827154445233"></p>
<p>点击POST发送：</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827154537569.png" alt="image-20210827154537569"></p>
<p>创建成功。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="string">&quot;_index&quot;</span>【索引】<span class="punctuation">:</span> <span class="string">&quot;shopping&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;_type&quot;</span>【类型-文档】<span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;_id&quot;</span>【唯一标识】<span class="punctuation">:</span> <span class="string">&quot;Xhsa2ncBlvF_7lxyCE9G&quot;</span><span class="punctuation">,</span> #可以类比为 MySQL 中的主键，随机生成</span><br><span class="line">    <span class="string">&quot;_version&quot;</span>【版本】<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="string">&quot;result&quot;</span>【结果】<span class="punctuation">:</span> <span class="string">&quot;created&quot;</span><span class="punctuation">,</span> #这里的 create 表示创建成功</span><br><span class="line">    <span class="string">&quot;_shards&quot;</span>【分片】<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="string">&quot;total&quot;</span>【分片 - 总数】<span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;successful&quot;</span>【分片 - 成功】<span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;failed&quot;</span>【分片 - 失败】<span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_seq_no&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_primary_term&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="2-3-2-文档查询"><a href="#2-3-2-文档查询" class="headerlink" title="2.3.2 文档查询"></a>2.3.2 文档查询</h3><p><strong>GET</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_doc/1001">http://127.0.0.1:9200/shopping/_doc/1001</a></p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827155153454.png" alt="image-20210827155153454"></p>
<p><strong>查询如果不存在的标签</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_doc/2201">http://127.0.0.1:9200/shopping/_doc/2201</a> </p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827155231274.png" alt="image-20210827155231274"></p>
<p><strong>全部查询</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a></p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827155402488.png" alt="image-20210827155402488"></p>
<h3 id="2-3-3-文档修改"><a href="#2-3-3-文档修改" class="headerlink" title="2.3.3 文档修改"></a>2.3.3 文档修改</h3><p><strong>完全覆盖修改-全量数据</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span><span class="string">&quot;华为手机&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;华为&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;images&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://www.gulixueyuan.com/hw.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">4999.00</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_doc/1001">http://127.0.0.1:9200/shopping/_doc/1001</a>   put</p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827155709955.png" alt="image-20210827155709955"></p>
<p><strong>局部修改</strong></p>
<p>使用_update进行修改</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_update/1002">http://127.0.0.1:9200/shopping/_update/1002</a></p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827170920053.png" alt="image-20210827170920053"></p>
<p><strong>删除</strong></p>
<p>使用delete</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_doc/1002">http://127.0.0.1:9200/shopping/_doc/1002</a></p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827171248533.png" alt="image-20210827171248533"></p>
<h3 id="2-3-4-查询"><a href="#2-3-4-查询" class="headerlink" title="2.3.4 查询"></a>2.3.4 查询</h3><p><strong>条件查询</strong></p>
<p>get</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_search?q=category:%E5%B0%8F%E7%B1%B3">http://127.0.0.1:9200/shopping/_search?q=category:小米</a>    </p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827172601502.png" alt="image-20210827172601502"></p>
<p>使用body体查询：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/shopping/_search">http://127.0.0.1:9200/shopping/_search</a></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;小米&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827173309153.png" alt="image-20210827173309153"></p>
<p><strong>分页查询</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;小米&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="comment">//起始数量</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="comment">//最终数量</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827173905508.png" alt="image-20210827173905508"></p>
<p><strong>数据源指定刷选</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;小米&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;title&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">//只查询title</span></span><br><span class="line">    <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span><span class="string">&quot;desc&quot;</span> <span class="comment">//按照order排序</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong>多条件查询</strong></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827175044088.png" alt="image-20210827175044088"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span>  <span class="comment">//表示条件的意思</span></span><br><span class="line">			<span class="attr">&quot;must&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;category&quot;</span><span class="punctuation">:</span><span class="string">&quot;小米&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">]</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827201810891.png" alt="image-20210827201810891"></p>
<h3 id="2-3-5-全文检索"><a href="#2-3-5-全文检索" class="headerlink" title="2.3.5 全文检索"></a>2.3.5 全文检索</h3><h3 id="2-3-6-聚合查询"><a href="#2-3-6-聚合查询" class="headerlink" title="2.3.6 聚合查询"></a>2.3.6 聚合查询</h3><h3 id="2-3-7-映射关系"><a href="#2-3-7-映射关系" class="headerlink" title="2.3.7 映射关系"></a>2.3.7 映射关系</h3><blockquote>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:9200/user">http://127.0.0.1:9200/user</a></p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827202748419.png" alt="image-20210827202748419"></p>
<p><strong>创建映射</strong></p>
<p>请求体中的内容</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tel&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;keyword&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827203215921.png" alt="image-20210827203215921"></p>
<p>发送请求：</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827203232889.png" alt="image-20210827203232889"></p>
<p>get查询_mapping:</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827203315780.png" alt="image-20210827203315780"></p>
<p><strong>测试</strong></p>
<p>先增添内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小米&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;男&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tel&quot;</span><span class="punctuation">:</span><span class="string">&quot;1111&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>链接：<a target="_blank" rel="noopener" href="http://127.0.0.1:9200/user/_create/1001">http://127.0.0.1:9200/user/_create/1001</a></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827203528304.png" alt="image-20210827203528304"></p>
<p>输入：<a target="_blank" rel="noopener" href="http://127.0.0.1:9200/user/_search">http://127.0.0.1:9200/user/_search</a></p>
<p>方法体内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>查询结果：</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827203741174.png" alt="image-20210827203741174"></p>
<p>我们会发现查性别”男”会查不到，一位内keyword是关键字，不能被分开。</p>
<p>查电话的时候是查不到的，因为index:false,表示改字段不能查到。</p>
<h1 id="3-JavaAPI"><a href="#3-JavaAPI" class="headerlink" title="3.JavaAPI"></a>3.JavaAPI</h1><h2 id="3-1-环境准备"><a href="#3-1-环境准备" class="headerlink" title="3.1 环境准备"></a>3.1 环境准备</h2><p><strong>创建maven项目</strong></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210827204338360.png" alt="image-20210827204338360"></p>
<p><strong>添加环境依赖</strong></p>
<p>文档上是这么说的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- elasticsearch 的客户端 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- elasticsearch 依赖 2.x 的 log4j --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- junit 单元测试 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>实际操作中：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;7.8.0&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- elasticsearch 的客户端 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.elasticsearch.client/elasticsearch-rest-high-level-client --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--&lt;exclusions&gt;</span></span><br><span class="line"><span class="comment">                &lt;exclusion&gt;</span></span><br><span class="line"><span class="comment">                    &lt;groupId&gt;org.elasticsearch&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">                    &lt;artifactId&gt;elasticsearch&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">                &lt;/exclusion&gt;</span></span><br><span class="line"><span class="comment">            &lt;/exclusions&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- elasticsearch 依赖 2.x 的 log4j --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- junit 单元测试 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后配置log4j的日志：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将等级为DEBUG的日志信息输出到console和file这两个目的地，console和file的定义在下面的代码</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">DEBUG,console,file,stdout</span></span><br><span class="line"><span class="attr">?</span></span><br><span class="line"><span class="comment">#控制台输出的相关设置</span></span><br><span class="line"><span class="attr">log4j.appender.console</span> = <span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.console.Target</span> = <span class="string">System.out</span></span><br><span class="line"><span class="attr">log4j.appender.console.Threshold</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.appender.console.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.console.layout.ConversionPattern</span>=<span class="string">[%c]-%m%n</span></span><br><span class="line"><span class="comment">#文件输出的相关设置</span></span><br><span class="line"><span class="attr">log4j.appender.file</span> = <span class="string">org.apache.log4j.RollingFileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.file.File</span>=<span class="string">./log/rzp.log</span></span><br><span class="line"><span class="attr">log4j.appender.file.MaxFileSize</span>=<span class="string">10mb</span></span><br><span class="line"><span class="attr">log4j.appender.file.Threshold</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout.ConversionPattern</span>=<span class="string">[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n</span></span><br><span class="line"><span class="comment">#日志输出级别</span></span><br><span class="line"><span class="attr">log4j.logger.org.mybatis</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.logger.java.sql</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.logger.java.sql.Statement</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.logger.java.sql.ResultSet</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.logger.java.sq1.PreparedStatement</span>=<span class="string">DEBUG# Global logging configuration</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># MyBatis logging configuration...</span></span><br><span class="line"><span class="attr">log4j.logger.org.mybatis.example.BlogMapper</span>=<span class="string">TRACE</span></span><br><span class="line"><span class="comment"># Console output...</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="3-2-客户端准备"><a href="#3-2-客户端准备" class="headerlink" title="3.2 客户端准备"></a>3.2 客户端准备</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ESTest_Client</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ESTest_Client.class);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭ES客户端</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828152432859.png" alt="image-20210828152432859"></p>
<h2 id="3-3-创建索引"><a href="#3-3-创建索引" class="headerlink" title="3.3 创建索引"></a>3.3 创建索引</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.org.slf4j.internal.Logger;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.slf4j.internal.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.CreateIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.CreateIndexResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:10:38</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ESTest_Index_Create</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ESTest_Index_Create.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        logger.error(<span class="string">&quot;========================创建索引====================&quot;</span>);</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建索引a</span></span><br><span class="line">        <span class="type">CreateIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreateIndexRequest</span>(<span class="string">&quot;dcx&quot;</span>);</span><br><span class="line">        <span class="type">CreateIndexResponse</span> <span class="variable">createIndexResponse</span> <span class="operator">=</span> esClient.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//响应状态</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">acknowledged</span> <span class="operator">=</span> createIndexResponse.isAcknowledged();</span><br><span class="line">        System.out.println(<span class="string">&quot;索引操作&quot;</span>+acknowledged);</span><br><span class="line"></span><br><span class="line">        esClient.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828152620048.png" alt="image-20210828152620048"></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828152655110.png" alt="image-20210828152655110"></p>
<h2 id="3-4-搜索索引"><a href="#3-4-搜索索引" class="headerlink" title="3.4 搜索索引"></a>3.4 搜索索引</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.IndicesClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.CreateIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.GetIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.GetIndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.cluster.metadata.AliasMetadata;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:11:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Search</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭ES客户端</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">GetIndexRequest</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>(<span class="string">&quot;dex&quot;</span>);</span><br><span class="line">            <span class="type">GetIndexResponse</span> <span class="variable">getIndexResponse</span> <span class="operator">=</span> esClient.indices().get(user, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//响应状态</span></span><br><span class="line">            System.out.println(getIndexResponse.getAliases());</span><br><span class="line">            System.out.println(getIndexResponse.getMappings());</span><br><span class="line">            System.out.println(getIndexResponse.getSettings());</span><br><span class="line"></span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828152945036.png" alt="image-20210828152945036"></p>
<h2 id="3-5-删除索引"><a href="#3-5-删除索引" class="headerlink" title="3.5 删除索引"></a>3.5 删除索引</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.support.master.AcknowledgedResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.GetIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.indices.GetIndexResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:15:30</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Delete</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//关闭ES客户端</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">DeleteIndexRequest</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteIndexRequest</span>(<span class="string">&quot;dex&quot;</span>);</span><br><span class="line">            <span class="type">AcknowledgedResponse</span> <span class="variable">delete</span> <span class="operator">=</span> esClient.indices().delete(user, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//响应状态</span></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;删除结果&quot;</span>+delete.isAcknowledged());</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line"></span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828153309451.png" alt="image-20210828153309451"></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828153326320.png" alt="image-20210828153326320"></p>
<p><strong>我们发现dex没了</strong></p>
<h2 id="3-6-文档操作"><a href="#3-6-文档操作" class="headerlink" title="3.6 文档操作"></a>3.6 文档操作</h2><h3 id="3-6-1-文档插入数据"><a href="#3-6-1-文档插入数据" class="headerlink" title="3.6.1 文档插入数据"></a>3.6.1 文档插入数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.Request;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:15:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_Insert</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//插入数据</span></span><br><span class="line">            <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>();</span><br><span class="line">            indexRequest.index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1001&quot;</span>);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">            user.setAge(<span class="number">20</span>);</span><br><span class="line">            user.setSex(<span class="string">&quot;男&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//向es插入数据，必须将数据转换为json数据</span></span><br><span class="line">            <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">            <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">            indexRequest.source(userJson, XContentType.JSON);</span><br><span class="line"></span><br><span class="line">            <span class="type">IndexResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.index(indexRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getResult());</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828154646914.png" alt="image-20210828154646914"></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://172.20.17.43:9200/user/_doc/1001">http://172.20.17.43:9200/user/_doc/1001</a></p>
</blockquote>
<p><strong>结果查询</strong></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828154706370.png" alt="image-20210828154706370"></p>
<h3 id="3-6-2-文档修改数据"><a href="#3-6-2-文档修改数据" class="headerlink" title="3.6.2 文档修改数据"></a>3.6.2 文档修改数据</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:15:47</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_update</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//修改数据</span></span><br><span class="line">            <span class="type">UpdateRequest</span> <span class="variable">update</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UpdateRequest</span>();</span><br><span class="line"></span><br><span class="line">            update.index(<span class="string">&quot;user&quot;</span>);  <span class="comment">//指定要修改的索引</span></span><br><span class="line">            update.index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1001&quot;</span>); <span class="comment">//指定修改的id</span></span><br><span class="line">            update.doc(XContentType.JSON,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;女&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="type">UpdateResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.update(update, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getGetResult());</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828155354296.png" alt="image-20210828155354296"></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828155403953.png" alt="image-20210828155403953"></p>
<p><strong>将性别由男改成女</strong></p>
<h3 id="3-6-3-文档查询"><a href="#3-6-3-文档查询" class="headerlink" title="3.6.3 文档查询"></a>3.6.3 文档查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:15:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_get</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//查询数据</span></span><br><span class="line">            <span class="type">GetRequest</span> <span class="variable">getRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetRequest</span>();</span><br><span class="line"></span><br><span class="line">            getRequest.index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1001&quot;</span>); <span class="comment">//指定修改的id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="type">GetResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.get(getRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getSourceAsString());</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828155859658.png" alt="image-20210828155859658"></p>
<h3 id="3-6-4-文档删除"><a href="#3-6-4-文档删除" class="headerlink" title="3.6.4 文档删除"></a>3.6.4 文档删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:15:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_delete</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//查询数据</span></span><br><span class="line">            <span class="type">DeleteRequest</span> <span class="variable">delete</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteRequest</span>();</span><br><span class="line"></span><br><span class="line">            delete.index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1001&quot;</span>); <span class="comment">//指定修改的id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="type">DeleteResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.delete(delete, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.toString());</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828161046047.png" alt="image-20210828161046047"></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828161102472.png" alt="image-20210828161102472"></p>
<h3 id="3-6-5-批量新增"><a href="#3-6-5-批量新增" class="headerlink" title="3.6.5 批量新增"></a>3.6.5 批量新增</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.Index;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:16:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_Insert_Batch</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//批量插入数据</span></span><br><span class="line">            <span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//概念：多个请求包装起来一起发送。</span></span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1001&quot;</span>).source(XContentType.JSON,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;zhangshan&quot;</span>));</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1002&quot;</span>).source(XContentType.JSON,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Lisi&quot;</span>));</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1003&quot;</span>).source(XContentType.JSON,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Wangwu&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">BulkResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getItems());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828162617398.png" alt="image-20210828162617398"></p>
<h3 id="3-6-6-批量删除"><a href="#3-6-6-批量删除" class="headerlink" title="3.6.6  批量删除"></a>3.6.6  批量删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:16:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_Delete_Batch</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//批量删除数据</span></span><br><span class="line">            <span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//概念：多个请求包装起来一起发送。</span></span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">DeleteRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1001&quot;</span>));</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">DeleteRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1002&quot;</span>));</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">DeleteRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1003&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">BulkResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getItems());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828162938247.png" alt="image-20210828162938247"></p>
<p><strong>批量新增和批量删除的区别</strong></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828163004207.png" alt="image-20210828163004207"></p>
<h2 id="3-7-高级文档操作"><a href="#3-7-高级文档操作" class="headerlink" title="3.7 高级文档操作"></a>3.7 高级文档操作</h2><h3 id="3-7-1-高级查询"><a href="#3-7-1-高级查询" class="headerlink" title="3.7.1 高级查询"></a>3.7.1 高级查询</h3><p><strong>首先我们批量新增数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.Index;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:16:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_Insert_Batch</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">//批量插入数据</span></span><br><span class="line">            <span class="type">BulkRequest</span> <span class="variable">bulkRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//概念：多个请求包装起来一起发送。</span></span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1001&quot;</span>).source(XContentType.JSON,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;zhangshan&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="number">30</span>,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;男&quot;</span>));</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1002&quot;</span>).source(XContentType.JSON,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Lisi&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="number">30</span>,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;女&quot;</span>));</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1003&quot;</span>).source(XContentType.JSON,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Wangwu&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="number">40</span>,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;男&quot;</span>));</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1003&quot;</span>).source(XContentType.JSON,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Wangwu2&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="number">50</span>,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;女&quot;</span>));</span><br><span class="line">            bulkRequest.add(<span class="keyword">new</span> <span class="title class_">IndexRequest</span>().index(<span class="string">&quot;user&quot;</span>).id(<span class="string">&quot;1003&quot;</span>).source(XContentType.JSON,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Wangwu3&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="number">60</span>,<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;男&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">BulkResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.bulk(bulkRequest, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getItems());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828163450175.png" alt="image-20210828163450175"></p>
<p><strong>高级查询源码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.elaticsearch.test.Search;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:16:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//查询数据</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>().query(QueryBuilders.matchAllQuery());</span><br><span class="line">            search.source(query);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828182634246.png" alt="image-20210828182634246"></p>
<h3 id="3-7-2-条件查询"><a href="#3-7-2-条件查询" class="headerlink" title="3.7.2 条件查询"></a>3.7.2 条件查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.elaticsearch.test.Search;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:16:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//条件查询</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            <span class="comment">//该条件查询语句：表示想要把年龄等于30的取出来</span></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>().query(QueryBuilders.termQuery(<span class="string">&quot;age&quot;</span>,<span class="number">30</span>));</span><br><span class="line">            search.source(query);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828183045248.png" alt="image-20210828183045248"></p>
<h3 id="3-7-3-分页查询"><a href="#3-7-3-分页查询" class="headerlink" title="3.7.3 分页查询"></a>3.7.3 分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.elaticsearch.test.Search;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:16:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//分页查询</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            <span class="comment">//该条件查询语句：表示想要把年龄等于30的取出来</span></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>().query(QueryBuilders.matchAllQuery());</span><br><span class="line">            <span class="comment">/*分页查询逻辑：from表示起始位置，size表示最终位置*/</span></span><br><span class="line">            builder.from(<span class="number">3</span>);</span><br><span class="line">            builder.size(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">            search.source(builder);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828183455171.png" alt="image-20210828183455171"></p>
<h3 id="3-7-4-结果排序"><a href="#3-7-4-结果排序" class="headerlink" title="3.7.4 结果排序"></a>3.7.4 结果排序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.elaticsearch.test.Search;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.SortOrder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:16:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//分页查询</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            <span class="comment">//该条件查询语句：表示想要把年龄等于30的取出来</span></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>().query(QueryBuilders.matchAllQuery());</span><br><span class="line">            <span class="comment">/*排序规则，选者要排序的字段，后面参数写排序规则*/</span></span><br><span class="line">            builder.sort(<span class="string">&quot;age&quot;</span>, SortOrder.DESC);</span><br><span class="line"></span><br><span class="line">            search.source(builder);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828184156949.png" alt="image-20210828184156949"></p>
<h3 id="3-7-5-过滤字段"><a href="#3-7-5-过滤字段" class="headerlink" title="3.7.5 过滤字段"></a>3.7.5 过滤字段</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.elaticsearch.test.Search;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.SortOrder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:16:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//过滤字段</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">            <span class="comment">//该条件查询语句：表示想要把年龄等于30的取出来</span></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>().query(QueryBuilders.matchAllQuery());</span><br><span class="line">            <span class="comment">/*过滤规则*/</span></span><br><span class="line">            <span class="comment">//选则你要排除的字段</span></span><br><span class="line">            String[] excludes=&#123;<span class="string">&quot;age&quot;</span>&#125;;</span><br><span class="line">            <span class="comment">//选择你要包含的字段</span></span><br><span class="line">            String[] includes=&#123;&#125;;</span><br><span class="line">            builder.fetchSource(includes,excludes);</span><br><span class="line"></span><br><span class="line">            search.source(builder);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828184508400.png" alt="image-20210828184508400"></p>
<h3 id="3-7-6-组合查询"><a href="#3-7-6-组合查询" class="headerlink" title="3.7.6 组合查询"></a>3.7.6 组合查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:19:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query_height</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//组合查询</span></span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//过滤字段</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">            <span class="type">BoolQueryBuilder</span> <span class="variable">boolQueryBuilder</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line"></span><br><span class="line">            boolQueryBuilder.must(QueryBuilders.matchQuery(<span class="string">&quot;age&quot;</span>,<span class="number">30</span>));</span><br><span class="line">            boolQueryBuilder.must(QueryBuilders.matchQuery(<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;男&quot;</span>));</span><br><span class="line">            <span class="comment">/*boolQueryBuilder.must(QueryBuilders.matchQuery(&quot;sex&quot;,&quot;男&quot;));</span></span><br><span class="line"><span class="comment">            boolQueryBuilder.mustNot(QueryBuilders.matchQuery(&quot;sex&quot;,&quot;男&quot;));</span></span><br><span class="line"><span class="comment">            boolQueryBuilder.should(QueryBuilders.matchQuery(&quot;sex&quot;,&quot;男&quot;));*/</span></span><br><span class="line"></span><br><span class="line">            builder.query(boolQueryBuilder);</span><br><span class="line"></span><br><span class="line">            search.source(builder);</span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828200716728.png" alt="image-20210828200716728"></p>
<h3 id="3-7-7-范围查询"><a href="#3-7-7-范围查询" class="headerlink" title="3.7.7 范围查询"></a>3.7.7 范围查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.RangeQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:19:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query_height</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//组合查询</span></span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//过滤字段</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">            <span class="type">RangeQueryBuilder</span> <span class="variable">rangeQuery</span> <span class="operator">=</span> QueryBuilders.rangeQuery(<span class="string">&quot;age&quot;</span>);</span><br><span class="line"></span><br><span class="line">            rangeQuery.gte(<span class="number">30</span>);</span><br><span class="line">            rangeQuery.lt(<span class="number">50</span>);</span><br><span class="line">            </span><br><span class="line">            builder.query(rangeQuery);</span><br><span class="line"></span><br><span class="line">            search.source(builder);</span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查询年龄范围在30-50岁的人。</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828201803556.png" alt="image-20210828201803556"></p>
<h3 id="3-7-8-模糊查询"><a href="#3-7-8-模糊查询" class="headerlink" title="3.7.8 模糊查询"></a>3.7.8 模糊查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.unit.Fuzziness;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.FuzzyQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.RangeQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:19:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query_height</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//组合查询</span></span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//过滤字段</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">            <span class="comment">//Fuzziness.ONE：差一个字符能匹配成功</span></span><br><span class="line">            builder.query(QueryBuilders.fuzzyQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;wangwu&quot;</span>).fuzziness(Fuzziness.ONE));</span><br><span class="line"></span><br><span class="line">            search.source(builder);</span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828202659502.png" alt="image-20210828202659502"></p>
<h3 id="3-7-9-高亮查询"><a href="#3-7-9-高亮查询" class="headerlink" title="3.7.9 高亮查询"></a>3.7.9 高亮查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.unit.Fuzziness;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.*;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:19:54</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_query_height</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//高亮查询</span></span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//过滤字段</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line">            <span class="comment">//Fuzziness.ONE：差一个字符能匹配成功</span></span><br><span class="line">            <span class="type">TermsQueryBuilder</span> <span class="variable">termsQueryBuilder</span> <span class="operator">=</span> QueryBuilders.termsQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;wangwu&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">HighlightBuilder</span> <span class="variable">highlightBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>();</span><br><span class="line">            highlightBuilder.preTags(<span class="string">&quot;&lt;font color=&#x27;red&#x27;&gt;&quot;</span>);</span><br><span class="line">            highlightBuilder.postTags(<span class="string">&quot;&lt;/font&gt;&quot;</span>);</span><br><span class="line">            highlightBuilder.field(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">            builder.highlighter(highlightBuilder);</span><br><span class="line">            builder.query(termsQueryBuilder);</span><br><span class="line"></span><br><span class="line">            search.source(builder);</span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-7-10-最大值查询"><a href="#3-7-10-最大值查询" class="headerlink" title="3.7.10 最大值查询"></a>3.7.10 最大值查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.elaticsearch.doc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.TermsQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.AggregationBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.aggregations.AggregationBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-28-时间:20:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">doc_min_max</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//高亮查询</span></span><br><span class="line">        <span class="comment">//创建ES客户端</span></span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">esClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(</span><br><span class="line">                RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//过滤字段</span></span><br><span class="line">            <span class="type">SearchRequest</span> <span class="variable">search</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>();</span><br><span class="line">            <span class="comment">//1.查询索引中全部的数据</span></span><br><span class="line">            search.indices(<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">SearchSourceBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchSourceBuilder</span>();</span><br><span class="line"></span><br><span class="line">            <span class="type">AggregationBuilder</span> <span class="variable">aggregationBuilder</span> <span class="operator">=</span>AggregationBuilders.max(<span class="string">&quot;maxAge&quot;</span>).field(<span class="string">&quot;age&quot;</span>);</span><br><span class="line"></span><br><span class="line">            builder.aggregation(aggregationBuilder);</span><br><span class="line"></span><br><span class="line">            search.source(builder);</span><br><span class="line">            <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> esClient.search(search, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">            System.out.println(response.getHits().getTotalHits());</span><br><span class="line">            System.out.println(response.getTook());</span><br><span class="line">            <span class="keyword">for</span> (SearchHit hit : response.getHits()) &#123;</span><br><span class="line">                System.out.println(hit.getSourceAsString());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;===============操作结果==============&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            esClient.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h1 id="4-Linux中的ES"><a href="#4-Linux中的ES" class="headerlink" title="4.Linux中的ES"></a>4.Linux中的ES</h1><h2 id="4-1-相关的概念"><a href="#4-1-相关的概念" class="headerlink" title="4.1 相关的概念"></a>4.1 相关的概念</h2><h3 id="4-1-1-单机-amp-集群"><a href="#4-1-1-单机-amp-集群" class="headerlink" title="4.1.1 单机&amp;集群"></a>4.1.1 单机&amp;集群</h3><p>单台 Elasticsearch 服务器提供服务，往往都有最大的负载能力，超过这个阈值，服务器 性能就会大大降低甚至不可用，所以生产环境中，一般都是运行在指定服务器集群中。 </p>
<p>除了负载能力，单点服务器也存在其他问题：</p>
<p>  单台机器存储容量有限</p>
<p>  单服务器容易出现单点故障，无法实现高可用</p>
<p>  单服务的并发处理能力有限 </p>
<p>配置服务器集群时，集群中节点数量没有限制，大于等于 2 个节点就可以看做是集群了。一 般出于高性能及高可用方面来考虑集群中节点数量都是 3 个以上。</p>
<h3 id="4-1-2-集群Cluster"><a href="#4-1-2-集群Cluster" class="headerlink" title="4.1.2 集群Cluster"></a>4.1.2 集群Cluster</h3><p>一个集群就是由一个或多个服务器节点组织在一起，共同持有整个的数据，并一起提供 索引和搜索功能。一个 Elasticsearch 集群有一个唯一的名字标识，这个名字默认就 是”elasticsearch”。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入 这个集群。</p>
<h3 id="4-1-3-节点Node"><a href="#4-1-3-节点Node" class="headerlink" title="4.1.3 节点Node"></a>4.1.3 节点Node</h3><p>集群中包含很多服务器，一个节点就是其中的一个服务器。作为集群的一部分，它存储 数据，参与集群的索引和搜索功能。</p>
<p> 一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色 的名字，这个名字会在启动的时候赋予节点。这个名字对于管理工作来说挺重要的，因为在 这个管理过程中，你会去确定网络中的哪些服务器对应于 Elasticsearch 集群中的哪些节点。 </p>
<p>一个节点可以通过配置集群名称的方式来加入一个指定的集群。默认情况下，每个节点 都会被安排加入到一个叫做“elasticsearch”的集群中，这意味着，如果你在你的网络中启动了 若干个节点，并假定它们能够相互发现彼此，它们将会自动地形成并加入到一个叫做 “elasticsearch”的集群中。</p>
<p>在一个集群里，只要你想，可以拥有任意多个节点。而且，如果当前你的网络中没有运 行任何 Elasticsearch 节点，这时启动一个节点，会默认创建并加入一个叫做“elasticsearch”的 集群。</p>
<h2 id="4-2-单机配置"><a href="#4-2-单机配置" class="headerlink" title="4.2 单机配置"></a>4.2 单机配置</h2><ol start="2">
<li>创建用户 因为安全问题，Elasticsearch 不允许 root 用户直接运行，所以要创建新用户，在 root 用 户中创建新用户</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd es <span class="comment">#新增 es 用户 </span></span><br><span class="line">passwd es <span class="comment">#为 es 用户设置密码 </span></span><br><span class="line">userdel -r es <span class="comment">#如果错了，可以删除再加 </span></span><br><span class="line"><span class="built_in">chown</span> -R es:es /opt/module/es <span class="comment">#文件夹所有者</span></span><br></pre></td></tr></table></figure>

<p>修改配置文件：</p>
<p>修改&#x2F;opt&#x2F;module&#x2F;es&#x2F;config&#x2F;elasticsearch.yml 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加入如下配置</span></span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line">node.name: node-1</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">cluster.initial_master_nodes: [<span class="string">&quot;node-1&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>修改&#x2F;etc&#x2F;security&#x2F;limits.conf：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在文件末尾中增加下面内容</span></span><br><span class="line"><span class="comment"># 每个进程可以打开的文件数的限制</span></span><br><span class="line">es soft nofile 65536</span><br><span class="line">es hard nofile 65536</span><br></pre></td></tr></table></figure>

<p>修改&#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;20-nproc.conf</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 在文件末尾中增加下面内容</span><br><span class="line"># 每个进程可以打开的文件数的限制</span><br><span class="line">es soft nofile <span class="number">65536</span></span><br><span class="line">es hard nofile <span class="number">65536</span></span><br><span class="line"># 操作系统级别对每个用户创建的进程数的限制</span><br><span class="line">* hard nproc <span class="number">4096</span></span><br><span class="line"># 注：* 带表 Linux 所有用户名称</span><br></pre></td></tr></table></figure>

<p>修改&#x2F;etc&#x2F;sysctl.conf</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 在文件中增加下面内容</span><br><span class="line"># 一个进程可以拥有的 VMA(虚拟内存区域)的数量,默认值为 <span class="number">65536</span></span><br><span class="line">vm.max_map_count=<span class="number">655360</span></span><br></pre></td></tr></table></figure>

<p>重新加载 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p </span><br></pre></td></tr></table></figure>



<p><strong>启动软件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/module/es/</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">bin/elasticsearch</span><br><span class="line"><span class="comment">#后台启动</span></span><br><span class="line">bin/elasticsearch -d</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210828214149857.png" alt="image-20210828214149857"></p>
<h2 id="4-3-Linux集群"><a href="#4-3-Linux集群" class="headerlink" title="4.3 Linux集群"></a>4.3 Linux集群</h2><p>ES安装和用户创建参照单机配置即可</p>
<p><strong>3) 修改配置文件</strong></p>
<p>修改&#x2F;opt&#x2F;module&#x2F;es&#x2F;config&#x2F;elasticsearch.yml 文件，分发文件</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加入如下配置</span></span><br><span class="line"><span class="comment">#集群名称</span></span><br><span class="line"><span class="attr">cluster.name:</span> <span class="string">cluster-es</span></span><br><span class="line"><span class="comment">#节点名称，每个节点的名称不能重复</span></span><br><span class="line"><span class="attr">node.name:</span> <span class="string">node-1</span></span><br><span class="line"><span class="comment">#ip 地址，每个节点的地址不能重复</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="string">linux1</span></span><br><span class="line"><span class="comment">#是不是有资格主节点</span></span><br><span class="line"><span class="attr">node.master:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">node.data:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.port:</span> <span class="number">9200</span></span><br><span class="line"><span class="comment"># head 插件需要这打开这两个配置</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.max_content_length:</span> <span class="string">200mb</span></span><br><span class="line"><span class="comment">#es7.x 之后新增的配置，初始化一个新的集群时需要此配置来选举 master</span></span><br><span class="line"><span class="attr">cluster.initial_master_nodes:</span> [<span class="string">&quot;node-1&quot;</span>]</span><br><span class="line"><span class="comment">#es7.x 之后新增的配置，节点发现</span></span><br><span class="line"><span class="attr">discovery.seed_hosts:</span> [<span class="string">&quot;linux1:9300&quot;</span>,<span class="string">&quot;linux2:9300&quot;</span>,<span class="string">&quot;linux3:9300&quot;</span>]</span><br><span class="line"><span class="attr">gateway.recover_after_nodes:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">network.tcp.keep_alive:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">network.tcp.no_delay:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">transport.tcp.compress:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#集群内同时启动的数据任务个数，默认是 2 个</span></span><br><span class="line"><span class="attr">cluster.routing.allocation.cluster_concurrent_rebalance:</span> <span class="number">16</span></span><br><span class="line"><span class="comment">#添加或删除节点及负载均衡时并发恢复的线程个数，默认 4 个</span></span><br><span class="line"><span class="attr">cluster.routing.allocation.node_concurrent_recoveries:</span> <span class="number">16</span></span><br><span class="line"><span class="comment">#初始化数据恢复时，并发恢复线程的个数，默认 4 个</span></span><br><span class="line"><span class="attr">cluster.routing.allocation.node_initial_primaries_recoveries:</span> <span class="number">16</span></span><br></pre></td></tr></table></figure>

<p>修改&#x2F;etc&#x2F;security&#x2F;limits.conf </p>
<p> 修改&#x2F;etc&#x2F;security&#x2F;limits.d&#x2F;20-nproc.conf</p>
<p>修改&#x2F;etc&#x2F;sysctl.conf</p>
<p> 重新加载 sysctl -p</p>
<p><strong>启动集群</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/module/es-cluster</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line">bin/elasticsearch</span><br><span class="line"><span class="comment">#后台启动</span></span><br><span class="line">bin/elasticsearch -d</span><br></pre></td></tr></table></figure>



<h1 id="5-Elasticsearch进阶"><a href="#5-Elasticsearch进阶" class="headerlink" title="5.Elasticsearch进阶"></a>5.Elasticsearch进阶</h1><h2 id="5-1-核心概念"><a href="#5-1-核心概念" class="headerlink" title="5.1 核心概念"></a>5.1 核心概念</h2><h3 id="5-1-1-索引-index"><a href="#5-1-1-索引-index" class="headerlink" title="5.1.1 索引(index)"></a>5.1.1 索引(index)</h3><p>一个索引就是一个拥有几分相似特征的文档的集合。比如说，你可以有一个客户数据的 索引，另一个产品目录的索引，还有一个订单数据的索引。一个索引由一个名字来标识（必 须全部是小写字母），并且当我们要对这个索引中的文档进行索引、搜索、更新和删除的时 候，都要使用到这个名字。在一个集群中，可以定义任意多的索引。 </p>
<p>能搜索的数据必须索引，这样的好处是可以提高查询速度，比如：新华字典前面的目录 就是索引的意思，目录可以提高查询速度。 </p>
<p>&#x3D;&#x3D;Elasticsearch 索引的精髓：一切设计都是为了提高搜索的性能。&#x3D;&#x3D;</p>
<h3 id="5-1-2-类型-Type"><a href="#5-1-2-类型-Type" class="headerlink" title="5.1.2 类型(Type)"></a>5.1.2 类型(Type)</h3><p>在一个索引中，你可以定义一种或多种类型。 一个类型是你的索引的一个逻辑上的分类&#x2F;分区，其语义完全由你来定。通常，会为具 有一组共同字段的文档定义一个类型。不同的版本，类型发生了不同的变化:</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210829111448061.png" alt="image-20210829111448061"></p>
<h3 id="5-1-3-文档-Document"><a href="#5-1-3-文档-Document" class="headerlink" title="5.1.3 文档(Document)"></a>5.1.3 文档(Document)</h3><p>一个文档是一个可被索引的基础信息单元，也就是一条数据 </p>
<p>比如：你可以拥有某一个客户的文档，某一个产品的一个文档，当然，也可以拥有某个 订单的一个文档。文档以 JSON（Javascript Object Notation）格式来表示，而 JSON 是一个 到处存在的互联网数据交互格式。 </p>
<p>在一个 index&#x2F;type 里面，你可以存储任意多的文档。</p>
<h3 id="5-1-4-字段（Field）"><a href="#5-1-4-字段（Field）" class="headerlink" title="5.1.4 字段（Field）"></a>5.1.4 字段（Field）</h3><p>相当于是数据表的字段，对文档数据根据不同属性进行的分类标识。</p>
<h3 id="5-1-5-映射-Mapping"><a href="#5-1-5-映射-Mapping" class="headerlink" title="5.1.5 映射(Mapping)"></a>5.1.5 映射(Mapping)</h3><p>mapping 是处理数据的方式和规则方面做一些限制，如：某个字段的数据类型、默认值、 分析器、是否被索引等等。这些都是映射里面可以设置的，其它就是处理 ES 里面数据的一 些使用规则设置也叫做映射，按着最优规则处理数据对性能提高很大，因此才需要建立映射， 并且需要思考如何建立映射才能对性能更好。</p>
<h3 id="5-1-6-分片（Shards）"><a href="#5-1-6-分片（Shards）" class="headerlink" title="5.1.6 分片（Shards）"></a>5.1.6 分片（Shards）</h3><p>一个索引可以存储超出单个节点硬件限制的大量数据。比如，一个具有 10 亿文档数据 的索引占据 1TB 的磁盘空间，而任一节点都可能没有这样大的磁盘空间。或者单个节点处 理搜索请求，响应太慢。为了解决这个问题，Elasticsearch 提供了将索引划分成多份的能力， 每一份就称之为分片。当你创建一个索引的时候，你可以指定你想要的分片的数量。每个分 片本身也是一个功能完善并且独立的“索引”，这个“索引”可以被放置到集群中的任何节点 上。</p>
<p>分片很重要，主要有两方面的原因： </p>
<p>1）允许你水平分割 &#x2F; 扩展你的内容容量。</p>
<p>2）允许你在分片之上进行分布式的、并行的操作，进而提高性能&#x2F;吞吐量。 </p>
<p>至于一个分片怎样分布，它的文档怎样聚合和搜索请求，是完全由 Elasticsearch 管理的， 对于作为用户的你来说，这些都是透明的，无需过分关心。</p>
<p>&#x3D;&#x3D;被混淆的概念是，一个 Lucene 索引 我们在 Elasticsearch 称作 分片 。 一个 Elasticsearch 索引 是分片的集合。 当 Elasticsearch 在索引中搜索的时候， 他发送查询 到每一个属于索引的分片(Lucene 索引)，然后合并每个分片的结果到一个全局的结果集。&#x3D;&#x3D;</p>
<h3 id="5-1-7-副本（Replicas）"><a href="#5-1-7-副本（Replicas）" class="headerlink" title="5.1.7 副本（Replicas）"></a>5.1.7 副本（Replicas）</h3><p>在一个网络 &#x2F; 云的环境里，失败随时都可能发生，在某个分片&#x2F;节点不知怎么的就处于 离线状态，或者由于任何原因消失了，这种情况下，有一个故障转移机制是非常有用并且是 强烈推荐的。为此目的，Elasticsearch 允许你创建分片的一份或多份拷贝，这些拷贝叫做复 制分片(副本)。</p>
<p>复制分片之所以重要，有两个主要原因：</p>
<p>1.在分片&#x2F;节点失败的情况下，提供了高可用性。因为这个原因，注意到复制分片从不与 原&#x2F;主要（original&#x2F;primary）分片置于同一节点上是非常重要的。 </p>
<p>2.扩展你的搜索量&#x2F;吞吐量，因为搜索可以在所有的副本上并行运行。</p>
<p>总之，每个索引可以被分成多个分片。一个索引也可以被复制 0 次（意思是没有复制） 或多次。一旦复制了，每个索引就有了主分片（作为复制源的原来的分片）和复制分片（主 分片的拷贝）之别。分片和复制的数量可以在索引创建的时候指定。在索引创建之后，你可 以在任何时候动态地改变复制的数量，但是你事后不能改变分片的数量。默认情况下， Elasticsearch 中的每个索引被分片 1 个主分片和 1 个复制，这意味着，如果你的集群中至少 有两个节点，你的索引将会有 1 个主分片和另外 1 个复制分片（1 个完全拷贝），这样的话 每个索引总共就有 2 个分片，我们需要根据索引需要确定分片个数。</p>
<h3 id="5-1-8-分配（Allocation）"><a href="#5-1-8-分配（Allocation）" class="headerlink" title="5.1.8 分配（Allocation）"></a>5.1.8 分配（Allocation）</h3><p>将分片分配给某个节点的过程，包括分配主分片或者副本。如果是副本，还包含从主分 片复制数据的过程。这个过程是由 master 节点完成的。</p>
<h2 id="4-2-系统架构"><a href="#4-2-系统架构" class="headerlink" title="4.2 系统架构"></a>4.2 系统架构</h2><p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210829112238895.png" alt="image-20210829112238895"></p>
<p>一个运行中的 Elasticsearch 实例称为一个节点，而集群是由一个或者多个拥有相同 cluster.name 配置的节点组成， 它们共同承担数据和负载的压力。当有节点加入集群中或者 从集群中移除节点时，集群将会重新平均分布所有的数据。</p>
<p>当一个节点被选举成为主节点时， 它将负责管理集群范围内的所有变更，例如增加、 删除索引，或者增加、删除节点等。 而主节点并不需要涉及到文档级别的变更和搜索等操 作，所以当集群只拥有一个主节点的情况下，即使流量的增加它也不会成为瓶颈。 任何节 点都可以成为主节点。我们的示例集群就只有一个节点，所以它同时也成为了主节点。</p>
<p>作为用户，我们可以将请求发送到集群中的任何节点 ，包括主节点。 每个节点都知道 任意文档所处的位置，并且能够将我们的请求直接转发到存储我们所需文档的节点。 无论 我们将请求发送到哪个节点，它都能负责从各个包含我们所需文档的节点收集回数据，并将 最终结果返回給客户端。 Elasticsearch 对这一切的管理都是透明的。</p>
<h1 id="6-Elasticsearch框架集成"><a href="#6-Elasticsearch框架集成" class="headerlink" title="6.Elasticsearch框架集成"></a>6.Elasticsearch框架集成</h1><h2 id="6-1-springDate框架集成"><a href="#6-1-springDate框架集成" class="headerlink" title="6.1 springDate框架集成"></a>6.1 springDate框架集成</h2><h3 id="6-1-1-SpringData框架介绍"><a href="#6-1-1-SpringData框架介绍" class="headerlink" title="6.1.1 SpringData框架介绍"></a>6.1.1 SpringData框架介绍</h3><p>Spring Data 是一个用于简化数据库、非关系型数据库、索引库访问，并支持云服务的 开源框架。其主要目标是使得对数据的访问变得方便快捷，并支持 map-reduce 框架和云计 算数据服务。 Spring Data 可以极大的简化 JPA（Elasticsearch„）的写法，可以在几乎不用 写实现的情况下，实现对数据的访问和操作。除了 CRUD 外，还包括如分页、排序等一些 常用的功能。 </p>
<p>Spring Data 的官网：<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data">https://spring.io/projects/spring-data</a></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210829181456006.png" alt="image-20210829181456006"></p>
<p>SpringData常用的功能如下：</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210829181800906.png" alt="image-20210829181800906"></p>
<h3 id="6-1-2-Spring-Data-Elasticsearch-介绍"><a href="#6-1-2-Spring-Data-Elasticsearch-介绍" class="headerlink" title="6.1.2 Spring Data Elasticsearch 介绍"></a>6.1.2 Spring Data Elasticsearch 介绍</h3><p>Spring Data Elasticsearch 基于 spring data API 简化 Elasticsearch 操作，将原始操作 Elasticsearch 的客户端 API 进行封装 。Spring Data 为 Elasticsearch 项目提供集成搜索引擎。 Spring Data Elasticsearch POJO 的关键功能区域为中心的模型与 Elastichsearch 交互文档和轻 松地编写一个存储索引库数据访问层。 官方网站: <a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data-elasticsearch">https://spring.io/projects/spring-data-elasticsearch</a></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210829182527220.png" alt="image-20210829182527220"></p>
<h2 id="6-2-框架集成"><a href="#6-2-框架集成" class="headerlink" title="6.2 框架集成"></a>6.2 框架集成</h2><h3 id="6-2-1-创建springBoot项目"><a href="#6-2-1-创建springBoot项目" class="headerlink" title="6.2.1 创建springBoot项目"></a>6.2.1 创建springBoot项目</h3><p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210829201341006.png" alt="image-20210829201341006"></p>
<h3 id="6-2-2-导入依赖"><a href="#6-2-2-导入依赖" class="headerlink" title="6.2.2 导入依赖"></a>6.2.2 导入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="6-2-3-创建实体类"><a href="#6-2-3-创建实体类" class="headerlink" title="6.2.3 创建实体类"></a>6.2.3 创建实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.es.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.Document;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.Field;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.FieldType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-29-时间:20:12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">/*@Document(indexName = &quot;product&quot;,shards = 3,replicas = 1)*/</span></span><br><span class="line"><span class="meta">@Document(indexName = &quot;product&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;<span class="comment">//商品唯一标识</span></span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text)</span></span><br><span class="line">    <span class="keyword">private</span> String title;<span class="comment">//商品名称</span></span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String category;<span class="comment">//分类名称</span></span><br><span class="line">    <span class="meta">@Field(type = FieldType.Double)</span></span><br><span class="line">    <span class="keyword">private</span> Double price;<span class="comment">//商品价格</span></span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword,index = false)</span> <span class="comment">//index = false表示不做索引关联</span></span><br><span class="line">    <span class="keyword">private</span> String images;<span class="comment">//图片地址</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="6-2-4-配置类"><a href="#6-2-4-配置类" class="headerlink" title="6.2.4 配置类"></a>6.2.4 配置类</h3><p> ElasticsearchRestTemplate 是 spring-data-elasticsearch 项目中的一个类，和其他 spring 项目中的 template 类似。 </p>
<p> 在新版的 spring-data-elasticsearch 中，ElasticsearchRestTemplate 代替了原来的 ElasticsearchTemplate。 </p>
<p> 原因是 ElasticsearchTemplate 基于 TransportClient，TransportClient 即将在 8.x 以后的版本中移除。所 以，我们推荐使用 ElasticsearchRestTemplate。 </p>
<p> ElasticsearchRestTemplate 基 于 RestHighLevelClient 客户端的。需要自定义配置类，继承 AbstractElasticsearchConfiguration，并实现 elasticsearchClient()抽象方法，创建 RestHighLevelClient 对 象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;elasticsearch&quot;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractElasticsearchConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> RestHighLevelClient <span class="title function_">elasticsearchClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RestClientBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> RestClient.builder(<span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;172.20.17.43&quot;</span>, <span class="number">9200</span>));</span><br><span class="line">        <span class="type">RestHighLevelClient</span> <span class="variable">restHighLevelClient</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">                <span class="title class_">RestHighLevelClient</span>(builder);</span><br><span class="line">        <span class="keyword">return</span> restHighLevelClient;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-2-5-创建和删除索引"><a href="#6-2-5-创建和删除索引" class="headerlink" title="6.2.5 创建和删除索引"></a>6.2.5 创建和删除索引</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.es.text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.es.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.core.ElasticsearchRestTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-30-时间:10:35</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringDataESIndexTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ElasticsearchRestTemplate elasticsearchRestTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createIndex</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建索引，系统初始化会自动创建索引</span></span><br><span class="line">        System.out.println(<span class="string">&quot;创建索引&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">deleteIndex</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建索引，系统初始化会自动创建索引</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> elasticsearchRestTemplate.deleteIndex(Product.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;删除索引是否成功====&gt;&quot;</span>+b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>创建索引：es会在运行的时候，自动为我们创建</strong></p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830110347887.png" alt="image-20210830110347887"></p>
<p><strong>删除索引</strong>：指定索引java文件</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830110451244.png" alt="image-20210830110451244"></p>
<h2 id="6-3-文档操作"><a href="#6-3-文档操作" class="headerlink" title="6.3 文档操作"></a>6.3 文档操作</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringDataESProductDaoTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductDao productDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-3-1-添加"><a href="#6-3-1-添加" class="headerlink" title="6.3.1 添加"></a>6.3.1 添加</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">/*新增*/</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">        product.setId(<span class="number">2L</span>);</span><br><span class="line">        product.setTitle(<span class="string">&quot;华为手机&quot;</span>);</span><br><span class="line">        product.setCategory(<span class="string">&quot;手机&quot;</span>);</span><br><span class="line">        product.setPrice(<span class="number">2999.0</span>);</span><br><span class="line">        product.setImages(<span class="string">&quot;存放的图片地址&quot;</span>);</span><br><span class="line">        productDao.save(product);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="http://172.20.17.43:9200/product/_doc/2">172.20.17.43:9200&#x2F;product&#x2F;_doc&#x2F;2</a></p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830111828347.png" alt="image-20210830111828347"></p>
<h3 id="6-3-2-修改"><a href="#6-3-2-修改" class="headerlink" title="6.3.2 修改"></a>6.3.2 修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">/*新增*/</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">        product.setId(<span class="number">2L</span>);</span><br><span class="line">        product.setTitle(<span class="string">&quot;小米手机&quot;</span>);</span><br><span class="line">        product.setCategory(<span class="string">&quot;手机&quot;</span>);</span><br><span class="line">        product.setPrice(<span class="number">2899.0</span>);</span><br><span class="line">        product.setImages(<span class="string">&quot;存放的图片地址&quot;</span>);</span><br><span class="line">        productDao.save(product);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="http://172.20.17.43:9200/product/_doc/2">172.20.17.43:9200&#x2F;product&#x2F;_doc&#x2F;2</a></p>
</blockquote>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830112020192.png" alt="image-20210830112020192"></p>
<h3 id="6-3-3-查询"><a href="#6-3-3-查询" class="headerlink" title="6.3.3 查询"></a>6.3.3 查询</h3><p><strong>根据id查询</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">/*根据id查询*/</span></span><br><span class="line">    <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productDao.findById(<span class="number">2L</span>).get();</span><br><span class="line">    System.out.println(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830112334209.png" alt="image-20210830112334209"></p>
<p><strong>查询全部</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findAll</span><span class="params">()</span>&#123;</span><br><span class="line">    Iterable&lt;Product&gt; all = productDao.findAll();</span><br><span class="line">    <span class="keyword">for</span> (Product product : all) &#123;</span><br><span class="line">        System.out.println(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830112449751.png" alt="image-20210830112449751"></p>
<h3 id="6-3-4-删除"><a href="#6-3-4-删除" class="headerlink" title="6.3.4 删除"></a>6.3.4 删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">    product.setId(<span class="number">2L</span>);</span><br><span class="line">    productDao.delete(product);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830112711825.png" alt="image-20210830112711825"></p>
<h3 id="6-3-5-批量新增"><a href="#6-3-5-批量新增" class="headerlink" title="6.3.5 批量新增"></a>6.3.5 批量新增</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAll</span><span class="params">()</span>&#123;</span><br><span class="line">    List&lt;Product&gt; productList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;<span class="number">10</span> ; i++) &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Product</span>();</span><br><span class="line">        product.setId(Long.valueOf(i));</span><br><span class="line">        product.setTitle(<span class="string">&quot;小米手机&quot;</span>+i);</span><br><span class="line">        product.setCategory(<span class="string">&quot;手机&quot;</span>);</span><br><span class="line">        product.setPrice(<span class="number">2899.0</span>*i);</span><br><span class="line">        product.setImages(<span class="string">&quot;存放的图片地址&quot;</span>+i);</span><br><span class="line">        productList.add(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    productDao.saveAll(productList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830113205404.png" alt="image-20210830113205404"></p>
<p>原来存在的字段，会进行覆盖，这里需要注意。</p>
<h3 id="6-3-6-分页查询"><a href="#6-3-6-分页查询" class="headerlink" title="6.3.6 分页查询"></a>6.3.6 分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findByPageable</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//设置排序（排序方式，正序还是倒叙，排序id）</span></span><br><span class="line">    <span class="type">Sort</span> <span class="variable">id</span> <span class="operator">=</span> Sort.by(Sort.Direction.DESC, <span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> currentPage=<span class="number">0</span>; <span class="comment">//当前页，第一页从0开始，1表示第二页</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">5</span> ; <span class="comment">//每页显示多少条</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置查询分页</span></span><br><span class="line">    <span class="type">PageRequest</span> <span class="variable">pageRequest</span> <span class="operator">=</span> PageRequest.of(currentPage, pageSize, id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//分页查询</span></span><br><span class="line">    Page&lt;Product&gt; all = productDao.findAll(pageRequest);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*for (Product product : all.getContent()) &#123;</span></span><br><span class="line"><span class="comment">        System.out.println(product);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Product product : all) &#123;</span><br><span class="line">        System.out.println(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830114114696.png" alt="image-20210830114114696"></p>
<h3 id="6-3-7-文档搜索"><a href="#6-3-7-文档搜索" class="headerlink" title="6.3.7 文档搜索"></a>6.3.7 文档搜索</h3><p><strong>搜索</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.es.text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.es.dao.ProductDao;</span><br><span class="line"><span class="keyword">import</span> com.es.pojo.Product;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.TermsQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>:左泽林</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>:日期:2021-08-30-时间:11:42</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@message</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringDataESSearchTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductDao productDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * @author: 左先生</span></span><br><span class="line"><span class="comment">     * @date: 2021-08-30 11:42</span></span><br><span class="line"><span class="comment">     * @description:term查询</span></span><br><span class="line"><span class="comment">     * search(termQueryBuilder) 调用搜索方法，参数查询构造器对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">termQuery</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">TermsQueryBuilder</span> <span class="variable">termsQueryBuilder</span> <span class="operator">=</span> QueryBuilders.termsQuery(<span class="string">&quot;category&quot;</span>, <span class="string">&quot;手机&quot;</span>);</span><br><span class="line">        Iterable&lt;Product&gt; search = productDao.search(termsQueryBuilder);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Product product : search) &#123;</span><br><span class="line">            System.out.println(product);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830114657027.png" alt="image-20210830114657027"></p>
<p><strong>文档分页搜索</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * term 查询加分页</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">termQueryByPage</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">int</span> currentPage= <span class="number">0</span> ;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pageSize</span> <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line">    <span class="comment">//设置查询分页</span></span><br><span class="line">    <span class="type">PageRequest</span> <span class="variable">pageRequest</span> <span class="operator">=</span> PageRequest.of(currentPage, pageSize);</span><br><span class="line">    <span class="type">TermQueryBuilder</span> <span class="variable">termQueryBuilder</span> <span class="operator">=</span> QueryBuilders.termQuery(<span class="string">&quot;category&quot;</span>, <span class="string">&quot;手机&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Iterable&lt;Product&gt; products = productDao.search(termQueryBuilder,pageRequest);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">        System.out.println(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830114907340.png" alt="image-20210830114907340"></p>
<h1 id="7-Elasticsearch优化"><a href="#7-Elasticsearch优化" class="headerlink" title="7.Elasticsearch优化"></a>7.Elasticsearch优化</h1><h2 id="7-1-硬件优化"><a href="#7-1-硬件优化" class="headerlink" title="7.1 硬件优化"></a>7.1 硬件优化</h2><p>Elasticsearch 的基础是 Lucene，所有的索引和文档数据是存储在本地的磁盘中，具体的 路径可在 ES 的配置文件..&#x2F;config&#x2F;elasticsearch.yml 中配置，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------------------------- Paths</span></span><br><span class="line">------------------------------------</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Path to directory where to store the data (separate multiple locations by comma):</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#path.data: /path/to/data</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Path to log files:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#path.logs: /path/to/logs</span></span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>磁盘在现代服务器上通常都是瓶颈。Elasticsearch 重度使用磁盘，你的磁盘能处理的吞吐量 越大，你的节点就越稳定。这里有一些优化磁盘 I&#x2F;O 的技巧： </p>
<p> 使用 SSD。就像其他地方提过的， 他们比机械磁盘优秀多了。 </p>
<p> 使用 RAID 0。条带化 RAID 会提高磁盘 I&#x2F;O，代价显然就是当一块硬盘故障时整个就故障了。不要 使用镜像或者奇偶校验 RAID 因为副本已经提供了这个功能。 </p>
<p> 另外，使用多块硬盘，并允许 Elasticsearch 通过多个 path.data 目录配置把数据条带化分配到它们上 面。 </p>
<p> 不要使用远程挂载的存储，比如 NFS 或者 SMB&#x2F;CIFS。这个引入的延迟对性能来说完全是背道而驰 的。</p>
<h2 id="7-2-分片策略"><a href="#7-2-分片策略" class="headerlink" title="7.2 分片策略"></a>7.2 分片策略</h2><h3 id="7-2-1-合理设置分片数"><a href="#7-2-1-合理设置分片数" class="headerlink" title="7.2.1  合理设置分片数"></a>7.2.1  合理设置分片数</h3><p>分片和副本的设计为 ES 提供了支持分布式和故障转移的特性，但并不意味着分片和 副本是可以无限分配的。而且索引的分片完成分配后由于索引的路由机制，&#x3D;&#x3D;我们是不能重新 修改分片数的&#x3D;&#x3D;。</p>
<p>可能有人会说，我不知道这个索引将来会变得多大，并且过后我也不能更改索引的大小， 所以为了保险起见，还是给它设为 1000 个分片吧。但是需要知道的是，一个分片并不是没 有代价的。需要了解：</p>
<p> 一个分片的底层即为一个 Lucene 索引，会消耗一定文件句柄、内存、以及 CPU 运转。 </p>
<p> 每一个搜索请求都需要命中索引中的每一个分片，如果每一个分片都处于不同的节点还好， 但如果多个分片都需要在同一个节点上竞争使用相同的资源就有些糟糕了。 </p>
<p> 用于计算相关度的词项统计信息是基于分片的。如果有许多分片，&#x3D;&#x3D;每一个都只有很少的数据会导致很 低的相关度&#x3D;&#x3D;。</p>
<p>一个业务索引具体需要分配多少分片可能需要&#x3D;&#x3D;架构师和技术人员&#x3D;&#x3D;对业务的增长有个预 先的判断，&#x3D;&#x3D;横向扩展&#x3D;&#x3D;应当分阶段进行。为下一阶段准备好足够的资源。 只有当你进入到下 一个阶段，你才有时间思考需要作出哪些改变来达到这个阶段。一般来说，我们遵循一些原 则：</p>
<p>&#x3D;&#x3D;控制每个分片占用的硬盘容量不超过 ES 的最大 JVM 的堆空间设置（一般设置不超过 32G，参考下文 的 JVM 设置原则），因此，如果索引的总容量在 500G 左右，那分片大小在 16 个左右即可；当然， 最好同时考虑原则 2&#x3D;&#x3D;。</p>
<p>  考虑一下 node 数量，一般一个节点有时候就是一台物理机，如果分片数过多，大大超过了节点数， 很可能会导致一个节点上存在多个分片，一旦该节点故障，即使保持了 1 个以上的副本，同样有可能 会导致数据丢失，集群无法恢复。所以， 一般都设置分片数不超过节点数的 3 倍。</p>
<p>  主分片，副本和节点最大数之间数量，我们分配的时候可以参考以下关系： 节点数 &lt;&#x3D; 主分片数*（副本数+1）</p>
<h3 id="7-2-2-推迟分片分配"><a href="#7-2-2-推迟分片分配" class="headerlink" title="7.2.2 推迟分片分配"></a>7.2.2 推迟分片分配</h3><p>对于节点瞬时中断的问题，默认情况，集群会等待一分钟来查看节点是否会重新加入， 如果这个节点在此期间重新加入，重新加入的节点会保持其现有的分片数据，不会触发新的 分片分配。这样就可以减少 ES 在自动再平衡可用分片时所带来的极大开销。</p>
<p>通过修改参数 delayed_timeout ，可以延长再均衡的时间，可以全局设置也可以在索引 级别进行修改:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT /_all/_settings </span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;index.unassigned.node_left.delayed_timeout&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5m&quot;</span> </span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="7-3-路由选择"><a href="#7-3-路由选择" class="headerlink" title="7.3 路由选择"></a>7.3 路由选择</h2><p>当我们查询文档的时候，Elasticsearch 如何知道一个文档应该存放到哪个分片中呢？它 其实是通过下面这个公式来计算出来: </p>
<p>&#x3D;&#x3D;shard &#x3D; hash(routing) % number_of_primary_shards routing&#x3D;&#x3D;</p>
<p>默认值是文档的 id，也可以采用自定义值，比如用户 id。</p>
<p><strong>不带 routing 查询</strong> </p>
<p>在查询的时候因为不知道要查询的数据具体在哪个分片上，所以整个过程分为 2 个步骤 </p>
<p> 分发：请求到达协调节点后，协调节点将查询请求分发到每个分片上。 </p>
<p> 聚合: 协调节点搜集到每个分片上查询结果，在将查询的结果进行排序，之后给用户返回结果。</p>
<p><strong>带 routing 查询</strong> </p>
<p>查询的时候，可以直接根据 routing 信息定位到某个分配查询，不需要查询所有的分配，经 过协调节点排序。 </p>
<p>向上面自定义的用户查询，如果 routing 设置为 userid 的话，就可以直接查询出数据来， 效率提升很多。</p>
<h2 id="7-4-写入速度优化"><a href="#7-4-写入速度优化" class="headerlink" title="7.4 写入速度优化"></a>7.4 写入速度优化</h2><p>ES 的默认配置，是综合了数据可靠性、写入速度、搜索实时性等因素。实际使用时， &#x3D;&#x3D;我们需要根据公司要求，进行偏向性的优化&#x3D;&#x3D;。 </p>
<p>针对于搜索性能要求不高，但是对写入要求较高的场景，我们需要尽可能的选择恰当写优化策略。综合来说，可以考虑以下几个方面来提升写索引的性能：</p>
<p> 加大 Translog Flush ，目的是降低 Iops、Writeblock。 </p>
<p> 增加 Index Refresh 间隔，目的是减少 Segment Merge 的次数。 </p>
<p> 调整 Bulk 线程池和队列。 </p>
<p> 优化节点间的任务分布。 </p>
<p> 优化 Lucene 层的索引建立，目的是降低 CPU 及 IO。</p>
<h3 id="7-4-1-批量数据提交"><a href="#7-4-1-批量数据提交" class="headerlink" title="7.4.1 批量数据提交"></a>7.4.1 批量数据提交</h3><p>ES 提供了 Bulk API 支持批量操作，当我们有大量的写任务时，可以使用 Bulk 来进 行批量写入。 </p>
<p>通用的策略如下：Bulk 默认设置批量提交的数据量不能超过 100M。数据条数一般是 根据文档的大小和服务器性能而定的，但是单次批处理的数据大小应从 5MB～15MB 逐渐 增加，当性能没有提升时，把这个数据量作为最大值。</p>
<h3 id="7-4-2-优化存储设备"><a href="#7-4-2-优化存储设备" class="headerlink" title="7.4.2 优化存储设备"></a>7.4.2 优化存储设备</h3><p>ES 是一种密集使用磁盘的应用，在段合并的时候会频繁操作磁盘，所以对磁盘要求较高，&#x3D;&#x3D;当磁盘速度提升之后&#x3D;&#x3D;，集群的整体性能会大幅度提高。</p>
<h3 id="7-4-3-合理使用合并"><a href="#7-4-3-合理使用合并" class="headerlink" title="7.4.3 合理使用合并"></a>7.4.3 合理使用合并</h3><p>Lucene 以段的形式存储数据。当有新的数据写入索引时，Lucene 就会自动创建一个新 的段。 </p>
<p>随着数据量的变化，段的数量会越来越多，消耗的多文件句柄数及 CPU 就越多，查询 效率就会下降。 </p>
<p>由于 Lucene 段合并的计算量庞大，会消耗大量的 I&#x2F;O，所以 ES 默认采用较保守的策 略，让后台定期进行段合并。</p>
<h3 id="7-4-4-减少-Refresh-的次数"><a href="#7-4-4-减少-Refresh-的次数" class="headerlink" title="7.4.4 减少 Refresh 的次数"></a>7.4.4 减少 Refresh 的次数</h3><p>Lucene 在新增数据时，采用了延迟写入的策略，默认情况下索引的 refresh_interval 为 1 秒。 </p>
<p>Lucene 将待写入的数据先写到内存中，超过 1 秒（默认）时就会触发一次 Refresh， 然后 Refresh 会把内存中的的数据刷新到操作系统的文件缓存系统中。 </p>
<p>如果我们对搜索的实效性要求不高，可以将 Refresh 周期延长，例如 30 秒。 </p>
<p>这样还可以有效地减少段刷新次数，但这同时意味着需要消耗更多的 Heap 内存。</p>
<h3 id="7-4-5-加大-Flush"><a href="#7-4-5-加大-Flush" class="headerlink" title="7.4.5 加大 Flush"></a>7.4.5 加大 Flush</h3><p>设置 Flush 的主要目的是把文件缓存系统中的段持久化到硬盘，当 Translog 的数据量达到 512MB 或者 30 分钟时，会触发一次 Flush。 </p>
<p>index.translog.flush_threshold_size 参数的默认值是 512MB，我们进行修改。 </p>
<p>增加参数值意味着文件缓存系统中可能需要存储更多的数据，所以我们需要为操作系统 的文件缓存系统留下足够的空间。 </p>
<h3 id="7-4-6-减少副本的数量"><a href="#7-4-6-减少副本的数量" class="headerlink" title="7.4.6 减少副本的数量"></a>7.4.6 减少副本的数量</h3><p>ES 为了保证集群的可用性，提供了 Replicas（副本）支持，然而每个副本也会执行分 析、索引及可能的合并过程，所以 Replicas 的数量会严重影响写索引的效率。 </p>
<p>当写索引时，需要把写入的数据都同步到副本节点，副本节点越多，写索引的效率就越 慢。 </p>
<p>如 果 我 们 需 要 大 批 量 进 行 写 入 操 作 ， 可 以 先 禁 止 Replica 复 制 ， 设 置 index.number_of_replicas: 0 关闭副本。在写入完成后，Replica 修改回正常的状态。</p>
<h2 id="7-5-内存设置"><a href="#7-5-内存设置" class="headerlink" title="7.5 内存设置"></a>7.5 内存设置</h2><p>ES 默认安装后设置的内存是 1GB，对于任何一个现实业务来说，这个设置都太小了。 如果是通过解压安装的 ES，则在 ES 安装文件中包含一个 jvm.option 文件，添加如下命 令来设置 ES 的堆大小，Xms 表示堆的初始大小，Xmx 表示可分配的最大内存，都是 1GB。 </p>
<p>确保 Xmx 和 Xms 的大小是相同的，其目的是为了能够在 Java 垃圾回收机制清理完 堆区后不需要重新分隔计算堆区的大小而浪费资源，可以减轻伸缩堆大小带来的压力。 </p>
<p>假设你有一个 64G 内存的机器，按照正常思维思考，你可能会认为把 64G 内存都给 ES 比较好，但现实是这样吗， 越大越好？虽然内存对 ES 来说是非常重要的，但是答案 是否定的！ </p>
<p>因为 ES 堆内存的分配需要满足以下两个原则： </p>
<p> &#x3D;&#x3D;不要超过物理内存的 50%&#x3D;&#x3D;：Lucene 的设计目的是把底层 OS 里的数据缓存到内存中。 Lucene 的段是分别存储到单个文件中的，这些文件都是不会变化的，所以很利于缓存，同时操作系 统也会把这些段文件缓存起来，以便更快的访问。 </p>
<p>如果我们设置的堆内存过大，Lucene 可用的内存将会减少，就会严重影响降低 Lucene 的全文本查 询性能。 </p>
<p> &#x3D;&#x3D;堆内存的大小最好不要超过 32GB&#x3D;&#x3D;：在 Java 中，所有对象都分配在堆上，然后有一个 Klass Pointer 指 针指向它的类元数据。 </p>
<p>这个指针在 64 位的操作系统上为 64 位，64 位的操作系统可以使用更多的内存（2^64）。在 32 位 的系统上为 32 位，32 位的操作系统的最大寻址空间为 4GB（2^32）。 </p>
<p>但是 64 位的指针意味着更大的浪费，因为你的指针本身大了。浪费内存不算，更糟糕的是，更大的 指针在主内存和缓存器（例如 LLC, L1 等）之间移动数据的时候，会占用更多的带宽。 </p>
<p>最终我们都会采用 31 G 设置 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Xms 31g -Xmx 31g </span><br></pre></td></tr></table></figure>

<p>假设你有个机器有 128 GB 的内存，你可以创建两个节点，每个节点内存分配不超过 32 GB。 也就是说 不超过 64 GB 内存给 ES 的堆内存，剩下的超过 64 GB 的内存给 Lucene</p>
<h2 id="7-6-重要配置"><a href="#7-6-重要配置" class="headerlink" title="7.6 重要配置"></a>7.6 重要配置</h2><table>
<thead>
<tr>
<th>参数名</th>
<th>参数值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>cluster.name</td>
<td>elasticsearch</td>
<td>配置 ES 的集群名称，默认值是 ES，建议改成与所存数据相关的名称，ES 会自动发现在同一网段下的 集群名称相同的节点</td>
</tr>
<tr>
<td>node.name</td>
<td>node-1</td>
<td>集群中的节点名，在同一个集群中不能重复。节点 的名称一旦设置，就不能再改变了。当然，也可以 设 置 成 服 务 器 的 主 机 名 称 ， 例 如 node.name:${HOSTNAME}。</td>
</tr>
<tr>
<td>node.master</td>
<td>true</td>
<td>指定该节点是否有资格被选举成为 Master 节点，默 认是 True，如果被设置为 True，则只是有资格成为 Master 节点，具体能否成为 Master 节点，需要通 过选举产生。</td>
</tr>
<tr>
<td>node.data</td>
<td>true</td>
<td>指定该节点是否存储索引数据，默认为 True。数据 的增、删、改、查都是在 Data 节点完成的。</td>
</tr>
<tr>
<td>index.number_of_shards</td>
<td>1</td>
<td>设置都索引分片个数，默认是 1 片。也可以在创建 索引时设置该值，具体设置为多大都值要根据数据 量的大小来定。如果数据量不大，则设置成 1 时效 率最高</td>
</tr>
<tr>
<td>index.number_of_replicas</td>
<td>1</td>
<td>设置默认的索引副本个数，默认为 1 个。副本数越 多，集群的可用性越好，但是写索引时需要同步的 数据越多。</td>
</tr>
<tr>
<td>transport.tcp.compress</td>
<td>true</td>
<td>设置在节点间传输数据时是否压缩，默认为 False， 不压缩</td>
</tr>
<tr>
<td>discovery.zen.minimum_master_nodes</td>
<td>1</td>
<td>设置在选举 Master 节点时需要参与的最少的候选 主节点数，默认为 1。如果使用默认值，则当网络 不稳定时有可能会出现脑裂。 合理的数值为 (master_eligible_nodes&#x2F;2)+1 ，其中 master_eligible_nodes 表示集群中的候选主节点数</td>
</tr>
<tr>
<td>discovery.zen.ping.timeout</td>
<td>3s</td>
<td>设置在集群中自动发现其他节点时 Ping 连接的超 时时间，默认为 3 秒。 在较差的网络环境下需要设置得大一点，防止因误 判该节点的存活状态而导致分片的转移</td>
</tr>
</tbody></table>
<h1 id="8-FaceQuestion"><a href="#8-FaceQuestion" class="headerlink" title="8.FaceQuestion"></a>8.FaceQuestion</h1><h2 id="8-1-为什么要使用-Elasticsearch"><a href="#8-1-为什么要使用-Elasticsearch" class="headerlink" title="8.1 为什么要使用 Elasticsearch?"></a>8.1 为什么要使用 Elasticsearch?</h2><p>系统中的数据，随着业务的发展，时间的推移，将会非常多，而业务中往往采用模糊查询进行数据的 搜索，而模糊查询会导致查询引擎放弃索引，导致系统查询数据时都是全表扫描，在百万级别的数据库中， 查询效率是非常低下的，而我们使用 ES 做一个全文索引，将经常查询的系统功能的某些字段，比如说电商系统的商品表中商品名，描述、价格还有 id 这些字段我们放入 ES 索引库里，可以提高查询速度。</p>
<h2 id="8-2-Elasticsearch-的-master-选举流程？"><a href="#8-2-Elasticsearch-的-master-选举流程？" class="headerlink" title="8.2 Elasticsearch 的 master 选举流程？"></a>8.2 Elasticsearch 的 master 选举流程？</h2><p> Elasticsearch 的选主是&#x3D;&#x3D;ZenDiscovery&#x3D;&#x3D;模块负责的，主要包含 Ping（节点之间通过这个 RPC 来发现彼此） 和 Unicast（单播模块包含一个主机列表以控制哪些节点需要 ping 通）这两部分 </p>
<p> &#x3D;&#x3D;对所有可以成为 master 的节点（node.master: true）根据 nodeId 字典排序&#x3D;&#x3D;，每次选举每个节点都把自 己所知道节点排一次序，然后选出第一个（第 0 位）节点，暂且认为它是 master 节点。 </p>
<p> 如果对某个节点的投票数达到一定的值（可以成为 master 节点数 n&#x2F;2+1）并且该节点自己也选举自己， 那这个节点就是 master。否则重新选举一直到满足上述条件。 </p>
<p> master 节点的职责主要包括集群、节点和索引的管理，不负责文档级别的管理；data 节点可以关闭 http 功能。</p>
<h2 id="8-3-Elasticsearch-集群脑裂问题？"><a href="#8-3-Elasticsearch-集群脑裂问题？" class="headerlink" title="8.3 Elasticsearch 集群脑裂问题？"></a>8.3 Elasticsearch 集群脑裂问题？</h2><p><strong>“脑裂”问题可能的成因</strong>: </p>
<p> <code>网络问题</code>：集群间的网络延迟导致一些节点访问不到 master，认为 master 挂掉了从而选举出新的 master，并对 master 上的分片和副本标红，分配新的主分片 </p>
<p> <code>节点负载</code>：主节点的角色既为 master 又为 data，访问量较大时可能会导致 ES 停止响应造成大面积延 迟，此时其他节点得不到主节点的响应认为主节点挂掉了，会重新选取主节点。 </p>
<p> <code>内存回收</code>：data 节点上的 ES 进程占用的内存较大，引发 JVM 的大规模内存回收，造成 ES 进程失去 响应。</p>
<p><strong>脑裂问题解决方案：</strong></p>
<p> <code>减少误判</code>：discovery.zen.ping_timeout 节点状态的响应时间，默认为 3s，可以适当调大，如果 master 在该响应时间的范围内没有做出响应应答，判断该节点已经挂掉了。调大参数（如 6s， discovery.zen.ping_timeout:6），可适当减少误判。 </p>
<p> <code>选举触发</code>: discovery.zen.minimum_master_nodes:1,该参数是用于控制选举行为发生的最小集群主节点数量。当备选主节点的个数大于等于该参数的值， 且备选主节点中有该参数个节点认为主节点挂了，进行选举。官方建议为（n&#x2F;2）+1，n 为主节点个数 （即有资格成为主节点的节点个数） </p>
<p> <code>角色分离</code>：即 master 节点与 data 节点分离，限制角色 主节点配置为：node.master: true node.data: false 从节点配置为：node.master: false node.data: true</p>
<h2 id="8-4-Elasticsearch-索引文档的流程？"><a href="#8-4-Elasticsearch-索引文档的流程？" class="headerlink" title="8.4 Elasticsearch 索引文档的流程？"></a>8.4 Elasticsearch 索引文档的流程？</h2><p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830144213517.png" alt="image-20210830144213517"></p>
<p> 协调节点默认使用文档 ID 参与计算（也支持通过 routing），以便为路由提供合适的分片： shard &#x3D; hash(document_id) % (num_of_primary_shards) </p>
<p> 当分片所在的节点接收到来自协调节点的请求后，会将请求写入到 Memory Buffer，然后定时（默认 是每隔 1 秒）写入到 Filesystem Cache，这个从 Memory Buffer 到 Filesystem Cache 的过程就叫做 refresh； </p>
<p> 当然在某些情况下，存在 Momery Buffer 和 Filesystem Cache 的数据可能会丢失，ES 是通过 translog 的机制来保证数据的可靠性的。其实现机制是接收到请求后，同时也会写入到 translog 中，当 Filesystem  cache 中的数据写入到磁盘中时，才会清除掉，这个过程叫做 flush； </p>
<p> 在 flush 过程中，内存中的缓冲将被清除，内容被写入一个新段，段的 fsync 将创建一个新的提交点， 并将内容刷新到磁盘，旧的 translog 将被删除并开始一个新的 translog。 </p>
<p> flush 触发的时机是定时触发（默认 30 分钟）或者 translog 变得太大（默认为 512M）时；</p>
<h2 id="8-5-Elasticsearch-更新和删除文档的流程？"><a href="#8-5-Elasticsearch-更新和删除文档的流程？" class="headerlink" title="8.5 Elasticsearch 更新和删除文档的流程？"></a>8.5 Elasticsearch 更新和删除文档的流程？</h2><p> 删除和更新也都是写操作，但是 Elasticsearch 中的文档是不可变的，因此不能被删除或者改动以展示 其变更； </p>
<p> 磁盘上的每个段都有一个相应的.del 文件。当删除请求发送后，文档并没有真的被删除，而是在.del 文件中被标记为删除。该文档依然能匹配查询，但是会在结果中被过滤掉。当段合并时，在.del 文件中被标记为删除的文档将不会被写入新段。 </p>
<p> 在新的文档被创建时，Elasticsearch 会为该文档指定一个版本号，当执行更新时，旧版本的文档在.del 文件中被标记为删除，新版本的文档被索引到一个新段。旧版本的文档依然能匹配查询，但是会在结 果中被过滤掉。</p>
<h2 id="8-6-Elasticsearch-搜索的流程？"><a href="#8-6-Elasticsearch-搜索的流程？" class="headerlink" title="8.6 Elasticsearch 搜索的流程？"></a>8.6 Elasticsearch 搜索的流程？</h2><p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830144358499.png" alt="image-20210830144358499"></p>
<p> 搜索被执行成一个两阶段过程，我们称之为 Query Then Fetch； </p>
<p> 在初始查询阶段时，查询会广播到索引中每一个分片拷贝（主分片或者副本分片）。 每个分片在本 地执行搜索并构建一个匹配文档的大小为 from + size 的优先队列。PS：在搜索的时候是会查询 Filesystem Cache 的，但是有部分数据还在 Memory Buffer，所以搜索是近实时的。 </p>
<p> 每个分片返回各自优先队列中 所有文档的 ID 和排序值 给协调节点，它合并这些值到自己的优先队 列中来产生一个全局排序后的结果列表。 </p>
<p> 接下来就是取回阶段，协调节点辨别出哪些文档需要被取回并向相关的分片提交多个 GET 请求。每 个分片加载并丰富文档，如果有需要的话，接着返回文档给协调节点。一旦所有的文档都被取回了， 协调节点返回结果给客户端。 </p>
<p> Query Then Fetch 的搜索类型在文档相关性打分的时候参考的是本分片的数据，这样在文档数量较少 的时候可能不够准确，DFS Query Then Fetch 增加了一个预查询的处理，询问 Term 和 Document  frequency，这个评分更准确，但是性能会变差。</p>
<h2 id="8-7-Elasticsearch-在部署时，对-Linux-的设置有哪些优化方法？"><a href="#8-7-Elasticsearch-在部署时，对-Linux-的设置有哪些优化方法？" class="headerlink" title="8.7 Elasticsearch 在部署时，对 Linux 的设置有哪些优化方法？"></a>8.7 Elasticsearch 在部署时，对 Linux 的设置有哪些优化方法？</h2><p> 64 GB 内存的机器是非常理想的，但是 32 GB 和 16 GB 机器也是很常见的。少于 8 GB 会适得其反。 </p>
<p> 如果你要在更快的 CPUs 和更多的核心之间选择，选择更多的核心更好。多个内核提供的额外并发远胜过稍微快一点点的时钟频率。 </p>
<p> 如果你负担得起 SSD，它将远远超出任何旋转介质。 基于 SSD 的节点，查询和索引性能都有提升。 如果你负担得起，SSD 是一个好的选择。 </p>
<p> 即使数据中心们近在咫尺，也要避免集群跨越多个数据中心。绝对要避免集群跨越大的地理距离。 </p>
<p> 请确保运行你应用程序的 JVM 和服务器的 JVM 是完全一样的。 在 Elasticsearch 的几个地方，使 用 Java 的本地序列化。 </p>
<p> 通过设置 gateway.recover_after_nodes、gateway.expected_nodes、gateway.recover_after_time 可以在集群 重启的时候避免过多的分片交换，这可能会让数据恢复从数个小时缩短为几秒钟。 </p>
<p> Elasticsearch 默认被配置为使用单播发现，以防止节点无意中加入集群。只有在同一台机器上运行的 节点才会自动组成集群。最好使用单播代替组播。 </p>
<p> 不要随意修改垃圾回收器（CMS）和各个线程池的大小。 </p>
<p> 把你的内存的（少于）一半给 Lucene（但不要超过 32 GB！），通过 ES_HEAP_SIZE 环境变量设置。 </p>
<p> 内存交换到磁盘对服务器性能来说是致命的。如果内存交换到磁盘上，一个 100 微秒的操作可能变 成 10 毫秒。 再想想那么多 10 微秒的操作时延累加起来。 不难看出 swapping 对于性能是多么可 怕。 </p>
<p> Lucene 使用了大量的文件。同时，Elasticsearch 在节点和 HTTP 客户端之间进行通信也使用了大量 的套接字。 所有这一切都需要足够的文件描述符。你应该增加你的文件描述符，设置一个很大的值， 如 64,000。</p>
<p><strong>补充：索引阶段性能提升方法</strong> </p>
<p> 使用批量请求并调整其大小：每次批量数据 5–15 MB 大是个不错的起始点。 </p>
<p> 存储：使用 SSD </p>
<p> 段和合并：Elasticsearch 默认值是 20 MB&#x2F;s，对机械磁盘应该是个不错的设置。如果你用的是 SSD， 可以考虑提高到 100–200 MB&#x2F;s。如果你在做批量导入，完全不在意搜索，你可以彻底关掉合并限流。 另外还可以增加 index.translog.flush_threshold_size 设置，从默认的 512 MB 到更大一些的值，比如 1  GB，这可以在一次清空触发的时候在事务日志里积累出更大的段。 </p>
<p> 如果你的搜索结果不需要近实时的准确度，考虑把每个索引的 index.refresh_interval 改到 30s。 </p>
<p> 如果你在做大批量导入，考虑通过设置 index.number_of_replicas: 0 关闭副本。</p>
<h2 id="8-8-GC-方面，在使用-Elasticsearch-时要注意什么？"><a href="#8-8-GC-方面，在使用-Elasticsearch-时要注意什么？" class="headerlink" title="8.8 GC 方面，在使用 Elasticsearch 时要注意什么？"></a>8.8 GC 方面，在使用 Elasticsearch 时要注意什么？</h2><p> 倒排词典的索引需要常驻内存，无法 GC，需要监控 data node 上 segment memory 增长趋势。</p>
<p> 各类缓存，field cache, filter cache, indexing cache, bulk queue 等等，要设置合理的大小，并且要应该根 据最坏的情况来看 heap 是否够用，也就是各类缓存全部占满的时候，还有 heap 空间可以分配给其他 任务吗？避免采用 clear cache 等“自欺欺人”的方式来释放内存。 </p>
<p> 避免返回大量结果集的搜索与聚合。确实需要大量拉取数据的场景，可以采用 scan &amp; scroll api 来实现。 </p>
<p> cluster stats 驻留内存并无法水平扩展，超大规模集群可以考虑分拆成多个集群通过 tribe node 连接。 </p>
<p> 想知道 heap 够不够，必须结合实际应用场景，并对集群的 heap 使用情况做持续的监控。</p>
<h2 id="8-9-Elasticsearch-对于大数据量（上亿量级）的聚合如何实现？"><a href="#8-9-Elasticsearch-对于大数据量（上亿量级）的聚合如何实现？" class="headerlink" title="8.9 Elasticsearch 对于大数据量（上亿量级）的聚合如何实现？"></a>8.9 Elasticsearch 对于大数据量（上亿量级）的聚合如何实现？</h2><p>Elasticsearch 提供的首个近似聚合是 cardinality 度量。它提供一个字段的基数，即该字段的 distinct 或者 unique 值的数目。它是基于 HLL 算法的。HLL 会先对我们的输入作哈希运算，然后根据哈希运算的 结果中的 bits 做概率估算从而得到基数。其特点是：可配置的精度，用来控制内存的使用（更精确 ＝ 更 多内存）；小的数据集精度是非常高的；我们可以通过配置参数，来设置去重需要的固定内存使用量。无 论数千还是数十亿的唯一值，内存使用量只与你配置的精确度相关。</p>
<h2 id="8-10-在并发情况下，Elasticsearch-如果保证读写一致？"><a href="#8-10-在并发情况下，Elasticsearch-如果保证读写一致？" class="headerlink" title="8.10 在并发情况下，Elasticsearch 如果保证读写一致？"></a>8.10 在并发情况下，Elasticsearch 如果保证读写一致？</h2><p> 可以通过<strong>版本号使用乐观并发控制</strong>，以确保新版本不会被旧版本覆盖，由应用层来处理具体的冲突； </p>
<p> 另外对于写操作，一致性级别支持 quorum&#x2F;one&#x2F;all，默认为 quorum，即只有当大多数分片可用时才允 许写操作。但即使大多数可用，也可能存在因为网络等原因导致写入副本失败，这样该副本被认为故 障，分片将会在一个不同的节点上重建。 </p>
<p> 对于读操作，可以设置 replication 为 sync(默认)，这使得操作在主分片和副本分片都完成后才会返回； 如果设置 replication 为 async 时，也可以通过设置搜索请求参数_preference 为 primary 来查询主分片， 确保文档是最新版本。</p>
<h2 id="8-11-如何监控-Elasticsearch-集群状态？"><a href="#8-11-如何监控-Elasticsearch-集群状态？" class="headerlink" title="8.11 如何监控 Elasticsearch 集群状态？"></a>8.11 如何监控 Elasticsearch 集群状态？</h2><p> elasticsearch-head 插件 通过 Kibana 监控 Elasticsearch。你可以实时查看你的集群健康状态和性能，也可以分析过去的集群、 索引和节点指标</p>
<h2 id="8-12-是否了解字典树？"><a href="#8-12-是否了解字典树？" class="headerlink" title="8.12 是否了解字典树？"></a>8.12 是否了解字典树？</h2><p>  常用字典数据结构如下所示:</p>
<p><img src="https://ccbigsbyzdqphoto.oss-cn-guangzhou.aliyuncs.com/image-20210830144814235.png" alt="image-20210830144814235"></p>
<p>字典树又称单词查找树，Trie 树，是一种树形结构，是一种哈希树的变种。典型应用是用于统计，排 序和保存大量的字符串（但不仅限于字符串），所以经常被搜索引擎系统用于文本词频统计。它的优点是： &#x3D;&#x3D;利用字符串的公共前缀来减少查询时间，最大限度地减少无谓的字符串比较，查询效率比哈希树高&#x3D;&#x3D;。 </p>
<p> Trie 的核心思想是空间换时间，利用字符串的公共前缀来降低查询时间的开销以达到提高效率的目的。 它有 3 个基本性质: </p>
<p>​	 根节点不包含字符，除根节点外每一个节点都只包含一个字符。 </p>
<p>​	 从根节点到某一节点，路径上经过的字符连接起来，为该节点对应的字符串。 </p>
<p>​	 每个节点的所有子节点包含的字符都不相同。 </p>
<p>对于中文的字典树，每个节点的子节点用一个哈希表存储，这样就不用浪费太大的空间，而且查询速度上 可以保留哈希的复杂度 O(1)。</p>
<h2 id="8-13-Elasticsearch-中的集群、节点、索引、文档、类型是什么？"><a href="#8-13-Elasticsearch-中的集群、节点、索引、文档、类型是什么？" class="headerlink" title="8.13 Elasticsearch 中的集群、节点、索引、文档、类型是什么？"></a>8.13 Elasticsearch 中的集群、节点、索引、文档、类型是什么？</h2><p> 集群是一个或多个节点（服务器）的集合，它们共同保存您的整个数据，并提供跨所有节点的联合索 引和搜索功能。群集由唯一名称标识，默认情况下为“elasticsearch”。此名称很重要，因为如果节点设 置为按名称加入群集，则该节点只能是群集的一部分。 </p>
<p> 节点是属于集群一部分的单个服务器。它存储数据并参与群集索引和搜索功能。 </p>
<p> 索引就像关系数据库中的“数据库”。它有一个定义多种类型的映射。索引是逻辑名称空间，映射到一 个或多个主分片，并且可以有零个或多个副本分片。 MySQL &#x3D;&gt;数据库 Elasticsearch &#x3D;&gt;索引 </p>
<p> 文档类似于关系数据库中的一行。不同之处在于索引中的每个文档可以具有不同的结构（字段），但 是对于通用字段应该具有相同的数据类型。 MySQL &#x3D;&gt; Databases &#x3D;&gt; Tables &#x3D;&gt; Columns &#x2F; Rows  Elasticsearch &#x3D;&gt; Indices &#x3D;&gt; Types &#x3D;&gt;具有属性的文档 </p>
<p> 类型是索引的逻辑类别&#x2F;分区，其语义完全取决于用户。</p>
<h2 id="8-14-Elasticsearch-中的倒排索引是什么？"><a href="#8-14-Elasticsearch-中的倒排索引是什么？" class="headerlink" title="8.14 Elasticsearch 中的倒排索引是什么？"></a>8.14 Elasticsearch 中的倒排索引是什么？</h2><p>倒排索引是搜索引擎的核心。搜索引擎的主要目标是在查找发生搜索条件的文档时提供快速搜索。ES 中的倒排索引其实就是 lucene 的倒排索引，区别于传统的正向索引，倒排索引会再存储数据时将关键词和数据进行关联，保存到倒排表中，然后查询时，将查询内容进行分词后在倒排表中进行查询，最后匹配数 据即可。</p>
<h2 id="8-15-ES为什么会这么快"><a href="#8-15-ES为什么会这么快" class="headerlink" title="8.15 ES为什么会这么快"></a>8.15 ES为什么会这么快</h2><ol>
<li>基于 Lucene 的全文检索引擎</li>
<li>在 ES 中采用的是一种名叫倒排索引的数据结构;</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">DingQuan Zuo</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/09/12/%E4%B8%AD%E9%97%B4%E4%BB%B6%E2%80%94%E2%80%94ElasticSearch/">http://example.com/2021/09/12/%E4%B8%AD%E9%97%B4%E4%BB%B6%E2%80%94%E2%80%94ElasticSearch/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">ccbigs blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="post_share"><div class="social-share" data-image="/img/ahead.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/09/14/JAVA%E2%80%94%E2%80%94JUC/" title="JAVA——JUC"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JAVA——JUC</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/10/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8E%9F%E7%90%86/" title="JVM虚拟机原理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JVM虚拟机原理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/08/22/%E4%B8%AD%E9%97%B4%E4%BB%B6%E2%80%94%E2%80%94KAFKA/" title="中间件——KAFKA"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-22</div><div class="title">中间件——KAFKA</div></div></a></div><div><a href="/2021/10/01/%E4%B8%AD%E9%97%B4%E4%BB%B6%E2%80%94%E2%80%94Nginx/" title="中间件——Nginx"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-01</div><div class="title">中间件——Nginx</div></div></a></div><div><a href="/2021/07/17/%E4%B8%AD%E9%97%B4%E4%BB%B6%E2%80%94%E2%80%94Zookeeper/" title="中间件——Zookeeper"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-17</div><div class="title">中间件——Zookeeper</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/ahead.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">DingQuan Zuo</div><div class="author-info__description">计算机很适合我这样的蠢人学，因为代码就在那里</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ccbigs" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://blog.csdn.net/zuodingquan666" target="_blank" title="CSDN"><i class="fas fa-c" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1692062014@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch"><span class="toc-text">ElasticSearch</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-ElasticSearch%E6%A6%82%E8%BF%B0"><span class="toc-text">1.ElasticSearch概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Elasticsearch-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">1.1 Elasticsearch 是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E"><span class="toc-text">1.2 全文搜索引擎</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Elasticsearch-And-Solr"><span class="toc-text">1.3 Elasticsearch And Solr</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-Elasticsearch-Or-Solr"><span class="toc-text">1.4 Elasticsearch Or Solr</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-Elasticsearch-%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">1.5 Elasticsearch 应用案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-ElasticSearch%E4%BD%BF%E7%94%A8"><span class="toc-text">2.ElasticSearch使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-text">2.1 数据格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E7%B4%A2%E5%BC%95"><span class="toc-text">2.2 索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E7%B4%A2%E5%BC%95%E5%88%9B%E5%BB%BA"><span class="toc-text">2.2.1 索引创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95-amp-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-text">2.2.2 查询索引&amp;删除索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-text">2.3 文档操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E6%96%87%E6%A1%A3%E5%88%9B%E5%BB%BA"><span class="toc-text">2.3.1 文档创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E6%96%87%E6%A1%A3%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.3.2 文档查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-%E6%96%87%E6%A1%A3%E4%BF%AE%E6%94%B9"><span class="toc-text">2.3.3 文档修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.3.4 查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="toc-text">2.3.5 全文检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-6-%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.3.6 聚合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-7-%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"><span class="toc-text">2.3.7 映射关系</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-JavaAPI"><span class="toc-text">3.JavaAPI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">3.1 环境准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%87%86%E5%A4%87"><span class="toc-text">3.2 客户端准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-text">3.3 创建索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E6%90%9C%E7%B4%A2%E7%B4%A2%E5%BC%95"><span class="toc-text">3.4 搜索索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-text">3.5 删除索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-text">3.6 文档操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-1-%E6%96%87%E6%A1%A3%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">3.6.1 文档插入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-2-%E6%96%87%E6%A1%A3%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-text">3.6.2 文档修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-3-%E6%96%87%E6%A1%A3%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.6.3 文档查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-4-%E6%96%87%E6%A1%A3%E5%88%A0%E9%99%A4"><span class="toc-text">3.6.4 文档删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-5-%E6%89%B9%E9%87%8F%E6%96%B0%E5%A2%9E"><span class="toc-text">3.6.5 批量新增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-6-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-text">3.6.6  批量删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-%E9%AB%98%E7%BA%A7%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-text">3.7 高级文档操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-1-%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7.1 高级查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-2-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7.2 条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-3-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7.3 分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-4-%E7%BB%93%E6%9E%9C%E6%8E%92%E5%BA%8F"><span class="toc-text">3.7.4 结果排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-5-%E8%BF%87%E6%BB%A4%E5%AD%97%E6%AE%B5"><span class="toc-text">3.7.5 过滤字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-6-%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7.6 组合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-7-%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7.7 范围查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-8-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7.8 模糊查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-9-%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7.9 高亮查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-10-%E6%9C%80%E5%A4%A7%E5%80%BC%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.7.10 最大值查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Linux%E4%B8%AD%E7%9A%84ES"><span class="toc-text">4.Linux中的ES</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E7%9B%B8%E5%85%B3%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">4.1 相关的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E5%8D%95%E6%9C%BA-amp-%E9%9B%86%E7%BE%A4"><span class="toc-text">4.1.1 单机&amp;集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E9%9B%86%E7%BE%A4Cluster"><span class="toc-text">4.1.2 集群Cluster</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E8%8A%82%E7%82%B9Node"><span class="toc-text">4.1.3 节点Node</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%8D%95%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-text">4.2 单机配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-Linux%E9%9B%86%E7%BE%A4"><span class="toc-text">4.3 Linux集群</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Elasticsearch%E8%BF%9B%E9%98%B6"><span class="toc-text">5.Elasticsearch进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">5.1 核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E7%B4%A2%E5%BC%95-index"><span class="toc-text">5.1.1 索引(index)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E7%B1%BB%E5%9E%8B-Type"><span class="toc-text">5.1.2 类型(Type)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-3-%E6%96%87%E6%A1%A3-Document"><span class="toc-text">5.1.3 文档(Document)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-4-%E5%AD%97%E6%AE%B5%EF%BC%88Field%EF%BC%89"><span class="toc-text">5.1.4 字段（Field）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-5-%E6%98%A0%E5%B0%84-Mapping"><span class="toc-text">5.1.5 映射(Mapping)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-6-%E5%88%86%E7%89%87%EF%BC%88Shards%EF%BC%89"><span class="toc-text">5.1.6 分片（Shards）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-7-%E5%89%AF%E6%9C%AC%EF%BC%88Replicas%EF%BC%89"><span class="toc-text">5.1.7 副本（Replicas）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-8-%E5%88%86%E9%85%8D%EF%BC%88Allocation%EF%BC%89"><span class="toc-text">5.1.8 分配（Allocation）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84"><span class="toc-text">4.2 系统架构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Elasticsearch%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90"><span class="toc-text">6.Elasticsearch框架集成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-springDate%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90"><span class="toc-text">6.1 springDate框架集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-SpringData%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D"><span class="toc-text">6.1.1 SpringData框架介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-Spring-Data-Elasticsearch-%E4%BB%8B%E7%BB%8D"><span class="toc-text">6.1.2 Spring Data Elasticsearch 介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E6%A1%86%E6%9E%B6%E9%9B%86%E6%88%90"><span class="toc-text">6.2 框架集成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E5%88%9B%E5%BB%BAspringBoot%E9%A1%B9%E7%9B%AE"><span class="toc-text">6.2.1 创建springBoot项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">6.2.2 导入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-3-%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">6.2.3 创建实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-4-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text">6.2.4 配置类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-5-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-text">6.2.5 创建和删除索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-text">6.3 文档操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-%E6%B7%BB%E5%8A%A0"><span class="toc-text">6.3.1 添加</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-%E4%BF%AE%E6%94%B9"><span class="toc-text">6.3.2 修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-3-%E6%9F%A5%E8%AF%A2"><span class="toc-text">6.3.3 查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-4-%E5%88%A0%E9%99%A4"><span class="toc-text">6.3.4 删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-5-%E6%89%B9%E9%87%8F%E6%96%B0%E5%A2%9E"><span class="toc-text">6.3.5 批量新增</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-6-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">6.3.6 分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-7-%E6%96%87%E6%A1%A3%E6%90%9C%E7%B4%A2"><span class="toc-text">6.3.7 文档搜索</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-Elasticsearch%E4%BC%98%E5%8C%96"><span class="toc-text">7.Elasticsearch优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E7%A1%AC%E4%BB%B6%E4%BC%98%E5%8C%96"><span class="toc-text">7.1 硬件优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%88%86%E7%89%87%E7%AD%96%E7%95%A5"><span class="toc-text">7.2 分片策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-%E5%90%88%E7%90%86%E8%AE%BE%E7%BD%AE%E5%88%86%E7%89%87%E6%95%B0"><span class="toc-text">7.2.1  合理设置分片数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-%E6%8E%A8%E8%BF%9F%E5%88%86%E7%89%87%E5%88%86%E9%85%8D"><span class="toc-text">7.2.2 推迟分片分配</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9"><span class="toc-text">7.3 路由选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-%E5%86%99%E5%85%A5%E9%80%9F%E5%BA%A6%E4%BC%98%E5%8C%96"><span class="toc-text">7.4 写入速度优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-1-%E6%89%B9%E9%87%8F%E6%95%B0%E6%8D%AE%E6%8F%90%E4%BA%A4"><span class="toc-text">7.4.1 批量数据提交</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-2-%E4%BC%98%E5%8C%96%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87"><span class="toc-text">7.4.2 优化存储设备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-3-%E5%90%88%E7%90%86%E4%BD%BF%E7%94%A8%E5%90%88%E5%B9%B6"><span class="toc-text">7.4.3 合理使用合并</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-4-%E5%87%8F%E5%B0%91-Refresh-%E7%9A%84%E6%AC%A1%E6%95%B0"><span class="toc-text">7.4.4 减少 Refresh 的次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-5-%E5%8A%A0%E5%A4%A7-Flush"><span class="toc-text">7.4.5 加大 Flush</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-6-%E5%87%8F%E5%B0%91%E5%89%AF%E6%9C%AC%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-text">7.4.6 减少副本的数量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-%E5%86%85%E5%AD%98%E8%AE%BE%E7%BD%AE"><span class="toc-text">7.5 内存设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-6-%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE"><span class="toc-text">7.6 重要配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-FaceQuestion"><span class="toc-text">8.FaceQuestion</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-Elasticsearch"><span class="toc-text">8.1 为什么要使用 Elasticsearch?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-Elasticsearch-%E7%9A%84-master-%E9%80%89%E4%B8%BE%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">8.2 Elasticsearch 的 master 选举流程？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-Elasticsearch-%E9%9B%86%E7%BE%A4%E8%84%91%E8%A3%82%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-text">8.3 Elasticsearch 集群脑裂问题？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-Elasticsearch-%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3%E7%9A%84%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">8.4 Elasticsearch 索引文档的流程？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-Elasticsearch-%E6%9B%B4%E6%96%B0%E5%92%8C%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3%E7%9A%84%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">8.5 Elasticsearch 更新和删除文档的流程？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-6-Elasticsearch-%E6%90%9C%E7%B4%A2%E7%9A%84%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-text">8.6 Elasticsearch 搜索的流程？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-7-Elasticsearch-%E5%9C%A8%E9%83%A8%E7%BD%B2%E6%97%B6%EF%BC%8C%E5%AF%B9-Linux-%E7%9A%84%E8%AE%BE%E7%BD%AE%E6%9C%89%E5%93%AA%E4%BA%9B%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-text">8.7 Elasticsearch 在部署时，对 Linux 的设置有哪些优化方法？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-8-GC-%E6%96%B9%E9%9D%A2%EF%BC%8C%E5%9C%A8%E4%BD%BF%E7%94%A8-Elasticsearch-%E6%97%B6%E8%A6%81%E6%B3%A8%E6%84%8F%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">8.8 GC 方面，在使用 Elasticsearch 时要注意什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-9-Elasticsearch-%E5%AF%B9%E4%BA%8E%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%87%8F%EF%BC%88%E4%B8%8A%E4%BA%BF%E9%87%8F%E7%BA%A7%EF%BC%89%E7%9A%84%E8%81%9A%E5%90%88%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%EF%BC%9F"><span class="toc-text">8.9 Elasticsearch 对于大数据量（上亿量级）的聚合如何实现？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-10-%E5%9C%A8%E5%B9%B6%E5%8F%91%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8CElasticsearch-%E5%A6%82%E6%9E%9C%E4%BF%9D%E8%AF%81%E8%AF%BB%E5%86%99%E4%B8%80%E8%87%B4%EF%BC%9F"><span class="toc-text">8.10 在并发情况下，Elasticsearch 如果保证读写一致？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-11-%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7-Elasticsearch-%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81%EF%BC%9F"><span class="toc-text">8.11 如何监控 Elasticsearch 集群状态？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-12-%E6%98%AF%E5%90%A6%E4%BA%86%E8%A7%A3%E5%AD%97%E5%85%B8%E6%A0%91%EF%BC%9F"><span class="toc-text">8.12 是否了解字典树？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-13-Elasticsearch-%E4%B8%AD%E7%9A%84%E9%9B%86%E7%BE%A4%E3%80%81%E8%8A%82%E7%82%B9%E3%80%81%E7%B4%A2%E5%BC%95%E3%80%81%E6%96%87%E6%A1%A3%E3%80%81%E7%B1%BB%E5%9E%8B%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">8.13 Elasticsearch 中的集群、节点、索引、文档、类型是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-14-Elasticsearch-%E4%B8%AD%E7%9A%84%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">8.14 Elasticsearch 中的倒排索引是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-15-ES%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E8%BF%99%E4%B9%88%E5%BF%AB"><span class="toc-text">8.15 ES为什么会这么快</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/10/21/appInstall%E2%80%94%E2%80%94Java%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4/" title="appInstall——Java安装步骤">appInstall——Java安装步骤</a><time datetime="2024-10-21T02:20:13.000Z" title="发表于 2024-10-21 10:20:13">2024-10-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/15/Rust%20%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/" title="Rust 程序设计语言">Rust 程序设计语言</a><time datetime="2024-09-15T11:19:19.000Z" title="发表于 2024-09-15 19:19:19">2024-09-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/06/28/appInstall%E2%80%94%E2%80%94mysql_windows%E7%89%88%E8%87%AA%E5%AE%9A%E4%B9%89%E7%AE%80%E6%98%93%E5%8C%96%E5%AE%89%E8%A3%85/" title="appInstall——mysql_windows版自定义简易化安装">appInstall——mysql_windows版自定义简易化安装</a><time datetime="2024-06-28T07:20:13.000Z" title="发表于 2024-06-28 15:20:13">2024-06-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/1558.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By DingQuan Zuo</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">道可道，非恒道也！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>